import{d as H,S as C,U as v,V as m,a8 as Ye,W as P,a0 as S,f as n,_ as q,X as E,Y as k,Z as x,y as N,c as Z,l as De,a9 as Je,aa as Xe,h as ne,t as me,g as We,r as Q,ab as ye,w as ge,o as Ne,ac as Pe,F as _e,a7 as be,a3 as we,ad as $e,ae as Ze,af as Ce,a2 as Ue,M as Ke,a4 as ea}from"./index-Cm6bZCtb.js";import{u as he,A as aa,a as ta,L as Le,D as oa,S as ra,m as qe}from"./matchService-Crjuql4m.js";import{Q as ve,a as ie}from"./QCard-Bu511efH.js";import{d as la}from"./date-Chuk8AoO.js";import{S as D,F as g,P as B}from"./graphql-DMYS3sVo.js";import{Q as na}from"./QBadge-Bk9hCOGO.js";import{_ as O,g as Te}from"./_plugin-vue_export-helper-CxHgfykZ.js";import{T as ia}from"./TeamLogo-D5majQd7.js";import{Q as sa,a as Ie}from"./QForm-cxEm4fb9.js";import{a as pe,c as xe,b as ua}from"./QCheckbox-DErdi7or.js";import{C as da}from"./ClosePopup-DBJUmWnX.js";import{u as Qe}from"./players-Cb9Sk1ng.js";import{Q as Ae,a as ae,b as U,c as j}from"./QList-C25ZtbNJ.js";import{Q as Me}from"./QRating-CrhRSJCT.js";import{u as ca,a as ma}from"./use-dark-CkpHGi7m.js";import{u as pa}from"./use-quasar-BjZ55HgA.js";import"./format-hlGAdIUH.js";import"./teamService-CHfQ816M.js";import"./private.use-form-Bt6FDSoW.js";import"./use-prevent-scroll-BbUsLF7j.js";import"./scroll-LBgmWIJC.js";const ya=H({__name:"MatchBadge",props:{color:{}},setup(o){return(l,e)=>(v(),C(na,{color:l.color,class:"match-badge"},{default:m(()=>[Ye(l.$slots,"default",{},void 0,!0)]),_:3},8,["color"]))}}),Ee=O(ya,[["__scopeId","data-v-a6da57b4"]]),ha={class:"match-header q-pa-md bg-primary text-white rounded-borders"},va={class:"row items-center justify-between q-col-gutter-md"},fa={class:"col-auto"},ga=H({__name:"MatchHeader",props:{status:{}},setup(o){const l=d=>{switch(d){case D.Scheduled:return"Scheduled";case D.InProgress:return"Live";case D.Completed:return"Finished";case D.Postponed:return"Postponed";case D.Cancelled:return"Cancelled";default:return"Unknown"}},e=d=>{switch(d){case D.Scheduled:return"blue";case D.InProgress:return"red";case D.Completed:return"green";case D.Postponed:return"orange";case D.Cancelled:return"grey";default:return"grey"}};return(d,c)=>(v(),P("div",ha,[S("div",va,[S("div",fa,[n(Ee,{color:e(d.status)},{default:m(()=>[E(k(l(d.status)),1)]),_:1},8,["color"]),d.status===x(D).InProgress?(v(),C(Ee,{key:0,color:"red",class:"q-ml-xs"},{default:m(()=>c[0]||(c[0]=[E(" LIVE ")])),_:1})):q("",!0)])])]))}}),_a=O(ga,[["__scopeId","data-v-6fe9b2ad"]]),ba={class:"team-display text-center"},wa={class:"text-h6 text-weight-bold"},Ia=H({__name:"TeamDisplay",props:{team:{},logoSize:{default:"80px"},buttonLabel:{default:"View Team"}},setup(o){return(l,e)=>{var d,c;return v(),P("div",ba,[n(ia,{"team-id":(d=l.team)==null?void 0:d.id,size:l.logoSize||"80px",class:"q-mb-sm"},null,8,["team-id","size"]),S("div",wa,k((c=l.team)==null?void 0:c.name),1),l.team?(v(),C(N,{key:0,flat:"","no-caps":"",color:"primary",to:`/teams/${l.team.id}`,label:l.buttonLabel,class:"q-mt-sm"},null,8,["to","label"])):q("",!0)])}}}),Ve=O(Ia,[["__scopeId","data-v-cca40ce4"]]),La={class:"match-score text-center"},Ta={key:0,class:"text-h3 text-weight-bold"},Sa={key:1,class:"text-h3 text-weight-bold text-grey"},ka={class:"text-subtitle1 q-mt-sm"},Ra={key:2,class:"text-caption"},Fa=H({__name:"MatchScore",props:{homeScore:{},awayScore:{},status:{},formattedDate:{},stadium:{}},setup(o){const l=o,e=Z(()=>l.status===D.InProgress||l.status===D.Completed);return(d,c)=>(v(),P("div",La,[e.value?(v(),P("div",Ta,k(d.homeScore)+" - "+k(d.awayScore),1)):(v(),P("div",Sa," vs ")),S("div",ka,k(d.formattedDate),1),d.stadium?(v(),P("div",Ra,k(d.stadium),1)):q("",!0)]))}}),Pa=O(Fa,[["__scopeId","data-v-6d0d635a"]]),$a={class:"match-detail-header"},Ca={class:"row items-center q-col-gutter-lg"},qa={class:"col-xs-12 col-sm-5"},xa={class:"col-xs-12 col-sm-2"},Aa={class:"col-xs-12 col-sm-5"},Ma=H({__name:"MatchDetailHeader",props:{match:{}},setup(o){const l=e=>{if(!e)return"N/A";try{return la.formatDate(e,"MMMM D, YYYY [at] h:mm A")}catch{return e}};return(e,d)=>(v(),P("div",$a,[n(ve,{flat:"",bordered:""},{default:m(()=>[n(_a,{status:e.match.status},null,8,["status"])]),_:1}),n(ve,{flat:"",bordered:"",class:"q-mt-md"},{default:m(()=>[n(ie,null,{default:m(()=>{var c,b;return[S("div",Ca,[S("div",qa,[n(Ve,{team:e.match.homeTeam},null,8,["team"])]),S("div",xa,[n(Pa,{"home-score":(c=e.match.score)==null?void 0:c.homeTeamScore,"away-score":(b=e.match.score)==null?void 0:b.awayTeamScore,status:e.match.status,"formatted-date":l(e.match.scheduledDate)},null,8,["home-score","away-score","status","formatted-date"])]),S("div",Aa,[n(Ve,{team:e.match.awayTeam},null,8,["team"])])])]}),_:1})]),_:1})]))}}),Ea=O(Ma,[["__scopeId","data-v-ffd8b5b5"]]),Va=De({name:"QCardActions",props:{...Je,vertical:Boolean},setup(o,{slots:l}){const e=Xe(o),d=Z(()=>`q-card__actions ${e.value} q-card__actions--${o.vertical===!0?"vert column":"horiz row"}`);return()=>ne("div",{class:d.value},me(l.default))}}),Ba=De({name:"QBanner",props:{...ca,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(o,{slots:l}){const{proxy:{$q:e}}=We(),d=ma(o,e),c=Z(()=>"q-banner row items-center"+(o.dense===!0?" q-banner--dense":"")+(d.value===!0?" q-banner--dark q-dark":"")+(o.rounded===!0?" rounded-borders":"")),b=Z(()=>`q-banner__actions row items-center justify-end col-${o.inlineActions===!0?"auto":"all"}`);return()=>{const _=[ne("div",{class:"q-banner__avatar col-auto row items-center self-start"},me(l.avatar)),ne("div",{class:"q-banner__content col text-body2"},me(l.default))],w=me(l.action);return w!==void 0&&_.push(ne("div",{class:b.value},w)),ne("div",{class:c.value+(o.inlineActions===!1&&w!==void 0?" q-banner--top-padding":""),role:"alert"},_)}}}),V={isRating:Q(!1),temporaryRatings:Q({}),startRatingMode(o){console.log("Starting rating mode"),this.isRating.value=!0,this.temporaryRatings.value={},o.forEach(l=>{if(l.playerId){const d=parseInt(l.position)<=11;console.log("Initializing rating for player:",l.playerId,"is starter:",d),this.temporaryRatings.value[l.playerId]=d?5:0}}),console.log("Initial temporary ratings:",this.temporaryRatings.value)},stopRatingMode(){console.log("Stopping rating mode"),this.isRating.value=!1,this.temporaryRatings.value={}},async savePlayerRating(o,l){try{console.log("Saving rating for player:",o,"rating:",l),await this.useAddSimpleRating().addSimpleRating(o,l)}catch(e){throw console.error("Error updating player rating:",e),e}},async updatePlayerRating(o,l){console.log("Updating rating for player:",o,"rating:",l),this.isRating.value?(this.temporaryRatings.value[o]=l,console.log("Temporary ratings after update:",this.temporaryRatings.value)):await this.savePlayerRating(o,l)},async saveAllRatings(){try{console.log("Starting to save ratings. Current temporary ratings:",this.temporaryRatings.value);for(const[o,l]of Object.entries(this.temporaryRatings.value))console.log("Saving rating for player:",o,"rating:",l),await this.savePlayerRating(o,l);this.temporaryRatings.value={},this.isRating.value=!1}catch(o){throw console.error("Error saving ratings:",o),o}},async removePlayerRating(o){console.log("Removing rating for player:",o),this.isRating.value?(this.temporaryRatings.value[o]=0,console.log("Temporary ratings after removal:",this.temporaryRatings.value)):await this.savePlayerRating(o,0)},getPlayerRating(o,l){if(this.isRating.value)return this.temporaryRatings.value[o]||5;const e=l.find(c=>c.playerId===o),d=(e==null?void 0:e.averageRating)||5;return console.log("Getting stored rating for player:",o,"rating:",d),d},useAddRating(){const{mutate:o,loading:l,error:e}=ye(ta),d=he();return{addRating:async b=>{var _,w;try{console.log("Adding rating with input:",b);const p=await o({input:b});if(console.log("Rating result:",p),(_=p==null?void 0:p.data)!=null&&_.addRating){const r=d.matches.findIndex(f=>{var y,I;return((y=f.homeTeamLineup)==null?void 0:y.players.some(A=>A.id===b.matchPlayerId))||((I=f.awayTeamLineup)==null?void 0:I.players.some(A=>A.id===b.matchPlayerId))});if(r!==-1){const f=d.matches[r];if(f.homeTeamLineup){const y=f.homeTeamLineup.players.findIndex(I=>I.id===b.matchPlayerId);y!==-1&&(f.homeTeamLineup.players[y].ratings||(f.homeTeamLineup.players[y].ratings=[]),f.homeTeamLineup.players[y].ratings.push(p.data.addRating))}if(f.awayTeamLineup){const y=f.awayTeamLineup.players.findIndex(I=>I.id===b.matchPlayerId);y!==-1&&(f.awayTeamLineup.players[y].ratings||(f.awayTeamLineup.players[y].ratings=[]),f.awayTeamLineup.players[y].ratings.push(p.data.addRating))}}}return(w=p==null?void 0:p.data)==null?void 0:w.addRating}catch(p){throw console.error("Error adding rating:",p),p}},loading:l,error:e}},useAddSimpleRating(){const{mutate:o,loading:l,error:e}=ye(aa),d=he();return{addSimpleRating:async(b,_)=>{var w,p;try{console.log("Adding simple rating for player:",b,"score:",_);const r=await o({matchPlayerId:b,score:_});if((w=r==null?void 0:r.data)!=null&&w.addSimpleRating){const f=d.matches.findIndex(y=>{var I,A;return((I=y.homeTeamLineup)==null?void 0:I.players.some(Y=>Y.id===b))||((A=y.awayTeamLineup)==null?void 0:A.players.some(Y=>Y.id===b))});if(f!==-1){const y=d.matches[f];if(y.homeTeamLineup){const I=y.homeTeamLineup.players.findIndex(A=>A.id===b);I!==-1&&(y.homeTeamLineup.players[I].ratings||(y.homeTeamLineup.players[I].ratings=[]),y.homeTeamLineup.players[I].ratings.push(r.data.addSimpleRating))}if(y.awayTeamLineup){const I=y.awayTeamLineup.players.findIndex(A=>A.id===b);I!==-1&&(y.awayTeamLineup.players[I].ratings||(y.awayTeamLineup.players[I].ratings=[]),y.awayTeamLineup.players[I].ratings.push(r.data.addSimpleRating))}}}return(p=r==null?void 0:r.data)==null?void 0:p.addSimpleRating}catch(r){throw console.error("Error adding simple rating:",r),r}},loading:l,error:e}},getRatingColor(o){return o>=9?"positive-10":o>=8?"positive-8":o>=7?"positive-6":o>=6?"warning-8":o>=5?"warning-6":o>=4?"negative-8":o>=3?"negative-10":"negative-14"}},Da={class:"lineup"},Na={key:0,class:"text-caption q-mb-sm"},Ua={key:1,class:"row q-col-gutter-md"},Qa={class:"col-12"},za={class:"row items-center justify-between"},Ga={class:"text-h6"},ja={class:"text-subtitle2"},Ha={class:"row q-gutter-sm"},Oa={class:"text-subtitle2 q-mb-sm"},Ya={key:1,class:"row items-center justify-between"},Ja={class:"row items-center"},Xa={class:"text-subtitle2 q-mt-md q-mb-sm"},Wa={class:"row items-center justify-between"},Za={class:"row items-center"},Ka={key:1,class:"row q-col-gutter-md q-mt-md"},et={class:"col-6"},at={class:"col-6"},tt={class:"col-12"},ot={class:"col-12"},rt=H({__name:"LineupCard",props:{team:{},loading:{type:Boolean},lineup:{}},emits:["update:lineup","save","add-player-click","update:team"],setup(o,{emit:l}){var Fe;const e=o,d=l,c=Qe(),b=c.playersByTeam[e.team.id]||[],_=[{label:"Custom",value:g.FormationCustom},{label:"4-4-2",value:g.Formation442},{label:"4-3-3",value:g.Formation433},{label:"3-5-2",value:g.Formation352},{label:"3-4-3",value:g.Formation343},{label:"4-2-3-1",value:g.Formation4231},{label:"4-3-2-1",value:g.Formation4321},{label:"5-3-2",value:g.Formation532},{label:"5-4-1",value:g.Formation541},{label:"4-5-1",value:g.Formation451},{label:"5-2-3",value:g.Formation523},{label:"4-1-4-1",value:g.Formation4141},{label:"3-1-4-2",value:g.Formation3142}],w=Q(g.Formation442);(Fe=e.lineup)!=null&&Fe.formation&&(w.value=e.lineup.formation);const p=Q([]),r=Q([]),f=Q(!1),y=Q(null),I=Q(g.Formation442),A=()=>{y.value=e.lineup?{...e.lineup}:null,I.value=w.value,f.value=!0},Y=()=>{y.value&&(w.value=I.value,J()),f.value=!1},J=()=>{if(e.lineup){p.value.forEach(a=>a.player=null),r.value.forEach(a=>a.player=null);for(const a of e.lineup.players){if(!a.player){console.warn("Skipping match player with no player data:",a);continue}const i=parseInt(a.position);if(isNaN(i)){console.warn("Invalid position number:",a.position);continue}if(i<=11){const h=p.value.find(u=>u.number===i);h?h.player=a:console.warn(`Could not find position ${i} in starting positions. Available positions:`,p.value.map(u=>u.number))}else{const h=r.value.find(u=>u.number===i);h?h.player=a:console.warn(`Could not find substitute position ${i}. Available substitute positions:`,r.value.map(u=>u.number))}}}},te=()=>{p.value=Array.from({length:11},(t,L)=>({number:L+1,role:B.Goalkeeper,player:null}));const a=w.value;let i=4,h=4,u=2;switch(a){case g.FormationCustom:break;case g.Formation442:i=4,h=4,u=2;break;case g.Formation433:i=4,h=3,u=3;break;case g.Formation352:i=3,h=5,u=2;break;case g.Formation343:i=3,h=4,u=3;break;case g.Formation4231:i=4,h=2,u=3;break;case g.Formation4321:i=4,h=3,u=2;break;case g.Formation532:i=5,h=3,u=2;break;case g.Formation541:i=5,h=4,u=1;break;case g.Formation451:i=4,h=5,u=1;break;case g.Formation523:i=5,h=2,u=3;break;case g.Formation4141:i=4,h=1,u=4;break;case g.Formation3142:i=3,h=1,u=4;break}let T=1;for(let t=0;t<i;t++)p.value[T].role=B.Defender,T++;for(let t=0;t<h;t++)p.value[T].role=B.Midfielder,T++;for(let t=0;t<u;t++)p.value[T].role=B.Forward,T++;r.value=Array.from({length:7},(t,L)=>({number:12+L,player:null}))};ge(w,()=>{te()}),ge(()=>e.lineup,a=>{var i;console.log("Lineup changed:",a),a&&(w.value=a.formation,te(),((i=c.playersByTeam[e.team.id])==null?void 0:i.length)>0&&J())},{immediate:!0}),ge(()=>c.playersByTeam[e.team.id],a=>{console.log("Team players changed:",a),a&&a.length>0&&e.lineup&&J()},{immediate:!0}),Ne(async()=>{if(console.log("LineupCard mounted with lineup:",e.lineup),te(),e.team&&(!c.playersByTeam[e.team.id]||c.playersByTeam[e.team.id].length===0))try{await c.fetchPlayersByTeam(e.team.id),e.lineup&&J()}catch(a){console.error("Failed to fetch team players:",a)}});const fe=()=>{var a,i,h,u,T;return{id:((a=e.lineup)==null?void 0:a.id)||"",teamId:e.team.id,matchId:((i=e.lineup)==null?void 0:i.matchId)||"",formation:w.value,players:[...p.value.filter(t=>t.player!==null).map(t=>{var L;return{id:t.player.id,playerId:t.player.playerId,lineupId:((L=e.lineup)==null?void 0:L.id)||"",isStarter:!0,position:t.number.toString(),teamId:e.team.id}}),...r.value.filter(t=>t.player!==null).map(t=>{var L;return{id:t.player.id,playerId:t.player.playerId,lineupId:((L=e.lineup)==null?void 0:L.id)||"",isStarter:!1,position:t.number.toString(),teamId:e.team.id}})],createdAt:((h=e.lineup)==null?void 0:h.createdAt)||new Date().toISOString(),updatedAt:((u=e.lineup)==null?void 0:u.updatedAt)||new Date().toISOString(),isStarting:((T=e.lineup)==null?void 0:T.isStarting)||!0}},oe=Z(()=>r.value.filter(a=>a.player!==null).map(a=>{var i,h,u;return{player_id:a.player.playerId,name:`${(i=a.player.player)==null?void 0:i.firstName} ${(h=a.player.player)==null?void 0:h.lastName}`,shirt_number:a.number,position:(u=a.player.player)==null?void 0:u.position}})),s=Z(()=>{const a=c.playersByTeam[e.team.id]||[],i=new Set([...p.value.map(h=>{var u;return(u=h.player)==null?void 0:u.playerId}),...r.value.map(h=>{var u;return(u=h.player)==null?void 0:u.playerId})]);return a.filter(h=>!i.has(h.id))}),$=a=>{var T;const i=c.playersByTeam[e.team.id]||[],h=new Set([...p.value.map(t=>{var L;return(L=t.player)==null?void 0:L.playerId}),...r.value.map(t=>{var L;return(L=t.player)==null?void 0:L.playerId})]),u=(T=p.value.find(t=>t.role===a))==null?void 0:T.player;return i.filter(t=>a===t.position).filter(t=>!h.has(t.id)||t.id===(u==null?void 0:u.playerId)).map(t=>{var L;return{id:"",playerId:t.id,lineupId:((L=e.lineup)==null?void 0:L.id)||"",isStarter:!0,position:a.toString(),teamId:e.team.id,player:t}})},z=Z(()=>{const a=p.value.filter(h=>h.player).length,i=r.value.filter(h=>h.player).length;return{is_valid:a===11&&i<=8,starting_count:a,substitute_count:i,message:a<11?`Need ${11-a} more starting players`:a>11?"Too many starting players":i>8?"Too many substitutes":"Valid lineup"}}),se=(a,i)=>{p.value[a].player=i},R=(a,i)=>{z.value.substitute_count>=8&&!r.value[a].player||(r.value[a].player=i)},ze=async()=>{var G;if(console.log("Starting auto-fill with team players:",b),!b.length){console.log("No players loaded, fetching team players...");try{await c.fetchPlayersByTeam(e.team.id)}catch(M){console.error("Failed to fetch team players:",M);return}}const a=[...c.playersByTeam[e.team.id]||[]];if(console.log("Available players:",a),!a.length){console.log("No players available for auto-fill");return}p.value.forEach(M=>M.player=null),r.value.forEach(M=>M.player=null);const i=a.find(M=>M.position===B.Goalkeeper);i&&(console.log("Found goalkeeper:",i),p.value[0].player={id:"",playerId:i.id,lineupId:((G=e.lineup)==null?void 0:G.id)||"",isStarter:!0,position:"1",teamId:e.team.id,player:i},a.splice(a.indexOf(i),1));const h=w.value;let u=4,T=4,t=2;switch(h){case g.Formation442:u=4,T=4,t=2;break;case g.Formation433:u=4,T=3,t=3;break;case g.Formation352:u=3,T=5,t=2;break;case g.Formation343:u=3,T=4,t=3;break;case g.Formation4231:u=4,T=2,t=3;break;case g.Formation4321:u=4,T=3,t=2;break;case g.Formation532:u=5,T=3,t=2;break;case g.Formation541:u=5,T=4,t=1;break;case g.Formation451:u=4,T=5,t=1;break;case g.Formation523:u=5,T=2,t=3;break;case g.Formation4141:u=4,T=1,t=4;break;case g.Formation3142:u=3,T=1,t=4;break}let L=1;const F=(M,X)=>{var W;for(let ee=0;ee<X&&L<p.value.length;ee++){let le=a.findIndex(ue=>ue.position===M);if(le===-1&&a.length>0&&(le=0),le!==-1){const ue=a[le];p.value[L].player={id:"",playerId:ue.id,lineupId:((W=e.lineup)==null?void 0:W.id)||"",isStarter:!0,position:L.toString(),teamId:e.team.id,player:ue},a.splice(le,1),L++}}};F(B.Defender,u),F(B.Midfielder,T),F(B.Forward,t),r.value.forEach((M,X)=>{var W;if(a.length>0){const ee=a.shift();ee&&(M.player={id:"",playerId:ee.id,lineupId:((W=e.lineup)==null?void 0:W.id)||"",isStarter:!1,position:(12+X).toString(),teamId:e.team.id,player:ee})}})},Ge=()=>{const a=fe();d("update:lineup",a),d("save"),f.value=!1},re=a=>a!=null&&a.player?`${a.player.firstName} ${a.player.lastName}`:"",je=()=>{var a;V.startRatingMode(((a=e.lineup)==null?void 0:a.players)||[])},He=()=>{V.stopRatingMode()},Oe=async()=>{try{await V.saveAllRatings()}catch(a){console.error("Error saving ratings:",a)}},Se=async(a,i)=>{try{await V.updatePlayerRating(a,i)}catch(h){console.error("Error updating player rating:",h)}},K=a=>{var i;return V.getPlayerRating(a,((i=e.lineup)==null?void 0:i.players)||[])},ke=a=>V.getRatingColor(a),Re=async a=>{try{await V.removePlayerRating(a)}catch(i){console.error("Error removing player rating:",i)}};return(a,i)=>{var h,u,T;return v(),P("div",Da,[f.value?(v(),P("div",Na," Lineup ID: "+k(((h=a.lineup)==null?void 0:h.id)||"None")+" Players: "+k(((T=(u=a.lineup)==null?void 0:u.players)==null?void 0:T.length)||0),1)):q("",!0),f.value?(v(),P("div",Ua,[S("div",Qa,[n(pe,{modelValue:w.value,"onUpdate:modelValue":i[0]||(i[0]=t=>w.value=t),options:_,label:"Formation",outlined:"",dense:"","emit-value":"","map-options":"",class:"q-mb-md"},null,8,["modelValue"])])])):q("",!0),a.team?(v(),C(ve,{key:2},{default:m(()=>[n(ie,{class:Pe([[f.value?"bg-primary":"bg-negative"],"text-white"])},{default:m(()=>[S("div",za,[S("div",null,[S("div",Ga,k(a.team.name),1),S("div",ja,"Formation: "+k(w.value),1)]),S("div",Ha,[f.value?q("",!0):(v(),C(N,{key:0,color:"white","text-color":"primary",icon:"edit",label:"Edit Lineup",onClick:A})),!f.value&&!x(V).isRating.value?(v(),C(N,{key:1,color:"white","text-color":"primary",icon:"star",label:"Rate Players",onClick:je})):q("",!0),x(V).isRating.value?(v(),C(N,{key:2,color:"white","text-color":"primary",icon:"close",label:"Close Rating",onClick:He})):q("",!0),x(V).isRating.value?(v(),C(N,{key:3,color:"white","text-color":"primary",icon:"save",label:"Save Ratings",onClick:Oe})):q("",!0)])])]),_:1},8,["class"]),n(ie,null,{default:m(()=>[S("div",Oa,"Starting XI ("+k(z.value.starting_count)+"/11)",1),n(Ae,{bordered:"",separator:""},{default:m(()=>[(v(!0),P(_e,null,be(p.value,(t,L)=>(v(),C(ae,{key:L},{default:m(()=>[n(U,{avatar:""},{default:m(()=>[n(we,{color:t.player?"primary":"grey","text-color":"white"},{default:m(()=>[E(k(t.number),1)]),_:2},1032,["color"])]),_:2},1024),n(U,null,{default:m(()=>[f.value?(v(),C(pe,{key:0,modelValue:t.player,"onUpdate:modelValue":[F=>t.player=F,F=>se(L,F)],options:$(t.role),"option-label":F=>re(F),label:t.role+" - Select Player",outlined:"",dense:"",clearable:"","emit-value":"","map-options":"",rules:[F=>!!F||"Player is required"]},{option:m(({itemProps:F,opt:G,selected:M,toggleOption:X})=>[n(ae,$e({ref_for:!0},F,{onClick:W=>X(G)}),{default:m(()=>[n(U,null,{default:m(()=>[n(j,null,{default:m(()=>[E(k(re(G)),1)]),_:2},1024),n(j,{caption:""},{default:m(()=>[E(k(G.position),1)]),_:2},1024)]),_:2},1024),n(U,{side:""},{default:m(()=>[n(xe,{dense:"","model-value":M},null,8,["model-value"])]),_:2},1024)]),_:2},1040,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","options","option-label","label","rules"])):(v(),P("div",Ya,[S("div",null,[n(j,null,{default:m(()=>[E(k(re(t.player)),1)]),_:2},1024),n(j,{caption:""},{default:m(()=>[E(k(t.role),1)]),_:2},1024)]),S("div",Ja,[x(V).isRating.value&&t.player?(v(),C(Me,{key:0,"model-value":K(t.player.id),size:"1.5em",max:10,color:ke(K(t.player.id)),icon:"star_border","icon-selected":"star","onUpdate:modelValue":F=>{console.log("Rating updated for player:",t.player.id,"value:",F),Se(t.player.id,F)}},null,8,["model-value","color","onUpdate:modelValue"])):q("",!0),x(V).isRating.value&&t.player&&K(t.player.id)>0?(v(),C(N,{key:1,flat:"",round:"",dense:"",color:"negative",icon:"close",size:"sm",class:"q-ml-sm",onClick:F=>Re(t.player.id)},null,8,["onClick"])):q("",!0)])]))]),_:2},1024)]),_:2},1024))),128))]),_:1}),S("div",Xa,"Substitutes ("+k(z.value.substitute_count)+"/8)",1),n(Ae,{bordered:"",separator:""},{default:m(()=>[f.value?(v(!0),P(_e,{key:0},be(r.value,(t,L)=>(v(),C(ae,{key:L},{default:m(()=>[n(U,{avatar:""},{default:m(()=>[n(we,{color:t.player?"grey-6":"grey","text-color":"white"},{default:m(()=>[E(k(t.number),1)]),_:2},1032,["color"])]),_:2},1024),n(U,null,{default:m(()=>[n(pe,{modelValue:t.player,"onUpdate:modelValue":[F=>t.player=F,F=>R(L,F)],options:s.value,"option-label":F=>re(F),label:"Select Substitute",outlined:"",dense:"",clearable:"","emit-value":"","map-options":"",disable:z.value.substitute_count>=8&&!t.player},{option:m(({itemProps:F,opt:G,selected:M,toggleOption:X})=>[n(ae,$e({ref_for:!0},F,{onClick:W=>X(G)}),{default:m(()=>[n(U,null,{default:m(()=>[n(j,null,{default:m(()=>[E(k(re(G)),1)]),_:2},1024),n(j,{caption:""},{default:m(()=>[E(k(G.position),1)]),_:2},1024)]),_:2},1024),n(U,{side:""},{default:m(()=>[n(xe,{dense:"","model-value":M},null,8,["model-value"])]),_:2},1024)]),_:2},1040,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","options","option-label","disable"])]),_:2},1024)]),_:2},1024))),128)):(v(!0),P(_e,{key:1},be(oe.value,t=>(v(),C(ae,{key:t.player_id},{default:m(()=>[n(U,{avatar:""},{default:m(()=>[n(we,{color:"grey-4","text-color":"grey-8"},{default:m(()=>[E(k(t.shirt_number),1)]),_:2},1024)]),_:2},1024),n(U,null,{default:m(()=>[S("div",Wa,[S("div",null,[n(j,null,{default:m(()=>[E(k(t.name),1)]),_:2},1024),n(j,{caption:""},{default:m(()=>[E(k(t.position),1)]),_:2},1024)]),S("div",Za,[x(V).isRating.value?(v(),C(Me,{key:0,"model-value":K(t.player_id),size:"1.5em",max:10,color:ke(K(t.player_id)),icon:"star_border","icon-selected":"star","onUpdate:modelValue":L=>{console.log("Rating updated for substitute:",t.player_id,"value:",L),Se(t.player_id,L)}},null,8,["model-value","color","onUpdate:modelValue"])):q("",!0),x(V).isRating.value&&K(t.player_id)>0?(v(),C(N,{key:1,flat:"",round:"",dense:"",color:"negative",icon:"close",size:"sm",class:"q-ml-sm",onClick:L=>Re(t.player_id)},null,8,["onClick"])):q("",!0)])])]),_:2},1024)]),_:2},1024))),128)),oe.value.length===0?(v(),C(ae,{key:2},{default:m(()=>[n(U,null,{default:m(()=>[n(j,{class:"text-grey-7"},{default:m(()=>i[2]||(i[2]=[E("No substitutes")])),_:1})]),_:1})]),_:1})):q("",!0)]),_:1}),f.value?(v(),C(Ba,{key:0,class:Pe([z.value.is_valid?"bg-positive":"bg-warning","text-white q-mt-md"])},{default:m(()=>[E(k(z.value.message),1)]),_:1},8,["class"])):q("",!0),f.value?(v(),P("div",Ka,[S("div",et,[n(N,{color:"primary",icon:"add",label:"Add New Player",class:"full-width",onClick:i[1]||(i[1]=t=>a.$emit("add-player-click"))})]),S("div",at,[n(N,{color:"secondary",icon:"auto_fix_high",label:"Auto-fill Lineup",class:"full-width",onClick:ze})]),S("div",tt,[n(N,{color:"positive",icon:"save",label:"Save Lineup",disable:!z.value.is_valid,loading:a.loading,onClick:Ge,class:"full-width"},null,8,["disable","loading"])]),S("div",ot,[n(N,{color:"negative",icon:"cancel",label:"Cancel",onClick:Y,class:"full-width"})])])):q("",!0)]),_:1})]),_:1})):q("",!0)])}}}),Be=O(rt,[["__scopeId","data-v-1e631291"]]),de=Ze("lineup",{state:()=>({lineups:{},loading:!1,error:null}),getters:{getLineupByteam_id:o=>l=>Object.values(o.lineups).find(e=>e.teamId===l),getLineupById:o=>l=>o.lineups[l]},actions:{setLineup(o){o.id&&(this.lineups[String(o.id)]=o)},setLoading(o){this.loading=o},setError(o){this.error=o},clearError(){this.error=null},removeLineup(o){delete this.lineups[o]}}});Te`
  query GetMatchLineups($filter: MatchFilterInput) {
    matches(first: 1, where: $filter) {
      nodes {
        ...LineupFields
      }
    }
  }
  ${Le}
`;const lt=Te`
  query GetLineup($id: String!) {
    lineup(id: $id) {
      ...LineupFields
    }
  }
  ${Le}
`,nt=Te`
  query GetTeamLineups($teamId: String!, $matchId: String) {
    teamLineups(teamId: $teamId, matchId: $matchId) {
      nodes {
        ...LineupFields
      }
    }
  }
  ${Le}
`,ce={useLineup(o){var _;const{result:l,loading:e,error:d,refetch:c}=Ce(lt,{id:o}),b=de();return(_=l.value)!=null&&_.lineup&&b.setLineup(l.value.lineup),{lineup:l,loading:e,error:d,refetch:c}},useTeamLineups(o,l){var w;const{result:e,loading:d,error:c,refetch:b}=Ce(nt,{teamId:o,matchId:l}),_=de();return(w=e.value)!=null&&w.teamLineups&&e.value.teamLineups.forEach(p=>{_.setLineup(p)}),{lineups:e,loading:d,error:c,refetch:b}},useSaveLineup(){const{mutate:o,loading:l,error:e}=ye(ra),d=de(),c=he();return{saveLineup:async _=>{var w,p;try{const r=await o({lineup:_});if((w=r==null?void 0:r.data)!=null&&w.saveLineup){const f=r.data.saveLineup;d.setLineup(f);const y=c.matches.findIndex(I=>I.id===_.matchId);if(y!==-1){const I=c.matches[y],A={...I,homeTeamLineupId:I.homeTeamId===_.teamId?f.id:I.homeTeamLineupId,awayTeamLineupId:I.awayTeamId===_.teamId?f.id:I.awayTeamLineupId,homeTeamLineup:I.homeTeamId===_.teamId?f:I.homeTeamLineup,awayTeamLineup:I.awayTeamId===_.teamId?f:I.awayTeamLineup};c.updateMatch(A)}}return(p=r==null?void 0:r.data)==null?void 0:p.saveLineup}catch(r){throw console.error("Error saving lineup:",r),r}},loading:l,error:e}},useDeleteLineup(){const{mutate:o,loading:l,error:e}=ye(oa),d=de(),c=he();return{deleteLineup:async _=>{var w,p;try{const r=await o({id:_});if((w=r==null?void 0:r.data)!=null&&w.deleteLineup){d.removeLineup(_);const f=c.matches.findIndex(y=>y.homeTeamLineupId===_||y.awayTeamLineupId===_);if(f!==-1){const y=c.matches[f],I={...y,homeTeamLineupId:y.homeTeamLineupId===_?null:y.homeTeamLineupId,awayTeamLineupId:y.awayTeamLineupId===_?null:y.awayTeamLineupId,homeTeamLineup:y.homeTeamLineupId===_?null:y.homeTeamLineup,awayTeamLineup:y.awayTeamLineupId===_?null:y.awayTeamLineup};c.updateMatch(I)}}return(p=r==null?void 0:r.data)==null?void 0:p.deleteLineup}catch(r){throw console.error("Error deleting lineup:",r),r}},loading:l,error:e}}},it={class:"match-lineups"},st={key:0,class:"flex justify-center q-pa-xl"},ut={key:1,class:"text-negative q-pa-md"},dt={key:2,class:"row q-col-gutter-md"},ct={class:"col-12 col-md-6"},mt={class:"col-12 col-md-6"},pt=H({__name:"MatchLineups",props:{match:{},loading:{type:Boolean},error:{}},emits:["update:match"],setup(o,{emit:l}){const e=o,d=l,c=Qe(),b=pa(),_=Q(!1),w=Q("home"),p=[{label:"Goalkeeper",value:B.Goalkeeper},{label:"Defender",value:B.Defender},{label:"Midfielder",value:B.Midfielder},{label:"Forward",value:B.Forward}],r=Q({first_name:"",last_name:"",position:B.Midfielder,number:null,nationality:"",date_of_birth:""}),f=s=>{w.value=s,_.value=!0},y=async s=>{await ce.useSaveLineup().saveLineup({...s,matchId:e.match.id,teamId:e.match.homeTeam.id})},I=async s=>{await ce.useSaveLineup().saveLineup({...s,matchId:e.match.id,teamId:e.match.awayTeam.id})},A=s=>{d("update:match",{...e.match,homeTeam:s})},Y=s=>{d("update:match",{...e.match,awayTeam:s})},J=s=>s.teamId?s.formation?Array.isArray(s.players)?s.players.length===0?(console.error("Invalid lineup: no players in the lineup"),!1):!0:(console.error("Invalid lineup: players must be an array"),!1):(console.error("Invalid lineup: missing formation"),!1):(console.error("Invalid lineup: missing teamId"),!1),te=async()=>{if(e.match.homeTeamLineup)try{if(!J(e.match.homeTeamLineup))throw new Error("Invalid lineup data");const s={...e.match.homeTeamLineup,matchId:e.match.id,teamId:e.match.homeTeam.id};await ce.useSaveLineup().saveLineup(s),b.notify({type:"positive",message:"Home team lineup saved successfully"})}catch(s){console.error("Failed to save home team lineup:",s),b.notify({type:"negative",message:s instanceof Error?s.message:"Failed to save home team lineup"})}},fe=async()=>{if(e.match.awayTeamLineup)try{if(!J(e.match.awayTeamLineup))throw new Error("Invalid lineup data");const s={...e.match.awayTeamLineup,matchId:e.match.id,teamId:e.match.awayTeam.id};await ce.useSaveLineup().saveLineup(s),b.notify({type:"positive",message:"Away team lineup saved successfully"})}catch(s){console.error("Failed to save away team lineup:",s),b.notify({type:"negative",message:s instanceof Error?s.message:"Failed to save away team lineup"})}},oe=async()=>{if(!r.value.first_name||!r.value.last_name||!r.value.position||!r.value.number){b.notify({type:"warning",message:"Please fill in all fields"});return}try{const s=w.value==="home"?e.match.homeTeamId:e.match.awayTeamId;await c.createPlayer({firstName:r.value.first_name,lastName:r.value.last_name,position:r.value.position,teamId:s}),await c.fetchPlayersByTeam(s),b.notify({type:"positive",message:"Player added successfully"}),r.value={first_name:"",last_name:"",position:B.Midfielder,number:null,nationality:"",date_of_birth:""},_.value=!1}catch(s){console.error("Error adding player:",s),b.notify({type:"negative",message:"Failed to add player"})}};return Ne(async()=>{try{if(e.match.homeTeam&&(!e.match.homeTeam.players||e.match.homeTeam.players.length===0))try{const s=await c.fetchPlayersByTeam(e.match.homeTeam.id);s&&(c.playersByTeam[e.match.homeTeam.id]=s)}catch(s){console.error("Failed to fetch home team players:",s)}if(e.match.awayTeam&&(!e.match.awayTeam.players||e.match.awayTeam.players.length===0))try{const s=await c.fetchPlayersByTeam(e.match.awayTeam.id);s&&(c.playersByTeam[e.match.awayTeam.id]=s)}catch(s){console.error("Failed to fetch away team players:",s)}}catch(s){console.error("Failed to initialize lineups:",s)}}),(s,$)=>{var z,se;return v(),P("div",it,[$[8]||($[8]=S("div",{class:"text-h6 q-mb-md"},"Lineups",-1)),s.loading?(v(),P("div",st,[n(Ue,{color:"primary",size:"3em"})])):s.error?(v(),P("div",ut,k(s.error),1)):(v(),P("div",dt,[S("div",ct,[(z=s.match)!=null&&z.homeTeam?(v(),C(Be,{key:0,team:s.match.homeTeam,lineup:s.match.homeTeamLineup,loading:s.loading,"onUpdate:lineup":y,onSave:te,onAddPlayerClick:$[0]||($[0]=R=>f("home")),"onUpdate:team":A},null,8,["team","lineup","loading"])):q("",!0)]),S("div",mt,[(se=s.match)!=null&&se.awayTeam?(v(),C(Be,{key:0,team:s.match.awayTeam,lineup:s.match.awayTeamLineup,loading:s.loading,"onUpdate:lineup":I,onSave:fe,onAddPlayerClick:$[1]||($[1]=R=>f("away")),"onUpdate:team":Y},null,8,["team","lineup","loading"])):q("",!0)])])),n(ua,{modelValue:_.value,"onUpdate:modelValue":$[6]||($[6]=R=>_.value=R),persistent:""},{default:m(()=>[n(ve,{style:{"min-width":"350px"}},{default:m(()=>[n(ie,null,{default:m(()=>$[7]||($[7]=[S("div",{class:"text-h6"},"Add New Player",-1)])),_:1}),n(ie,{class:"q-pt-none"},{default:m(()=>[n(sa,{onSubmit:oe,class:"q-gutter-md"},{default:m(()=>[n(Ie,{modelValue:r.value.first_name,"onUpdate:modelValue":$[2]||($[2]=R=>r.value.first_name=R),label:"First Name",rules:[R=>!!R||"First name is required"]},null,8,["modelValue","rules"]),n(Ie,{modelValue:r.value.last_name,"onUpdate:modelValue":$[3]||($[3]=R=>r.value.last_name=R),label:"Last Name",rules:[R=>!!R||"Last name is required"]},null,8,["modelValue","rules"]),n(pe,{modelValue:r.value.position,"onUpdate:modelValue":$[4]||($[4]=R=>r.value.position=R),options:p,label:"Position",rules:[R=>!!R||"Position is required"]},null,8,["modelValue","rules"]),n(Ie,{modelValue:r.value.number,"onUpdate:modelValue":$[5]||($[5]=R=>r.value.number=R),modelModifiers:{number:!0},type:"number",label:"Jersey Number",rules:[R=>!!R||"Jersey number is required",R=>R>0||"Jersey number must be positive",R=>R<=99||"Jersey number must be less than 100"]},null,8,["modelValue","rules"])]),_:1})]),_:1}),n(Va,{align:"right",class:"text-primary"},{default:m(()=>[Ke(n(N,{flat:"",label:"Cancel"},null,512),[[da]]),n(N,{flat:"",label:"Add Player",type:"submit",onClick:oe})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),yt=O(pt,[["__scopeId","data-v-3cb0ccbd"]]),ht={class:"match-detail"},vt={key:0,class:"flex justify-center q-pa-xl"},ft={key:1,class:"text-negative q-pa-md"},gt={key:2,class:"match-content"},_t=H({__name:"MatchDetailPage",setup(o){const l=ea(),{match:e,loading:d,error:c}=qe.useMatch(l.params.id),b=async _=>{try{const{updateMatch:w}=qe.useUpdateMatch();await w(_)}catch(w){console.error("Error updating match:",w)}};return(_,w)=>{var p,r;return v(),P("div",ht,[x(d)?(v(),P("div",vt,[n(Ue,{color:"primary",size:"3em"})])):x(c)?(v(),P("div",ft,k(x(c).message),1)):(v(),P("div",gt,[n(Ea,{match:x(e),loading:x(d),error:(p=x(c))==null?void 0:p.message,"onUpdate:match":b},null,8,["match","loading","error"]),n(yt,{match:x(e),loading:x(d),error:(r=x(c))==null?void 0:r.message,"onUpdate:match":b},null,8,["match","loading","error"])]))])}}}),Ut=O(_t,[["__scopeId","data-v-fde4378c"]]);export{Ut as default};
