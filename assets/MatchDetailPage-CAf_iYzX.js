import{M as x,J as R,L as _,V as o,a6 as ca,r as G,d as O,N as C,Z as P,K as V,S as t,W as M,X as k,T as E,i as N,Q as ea,R as Re,u as Ae,O as ie,a as De,g as aa,h as j,e as me,a7 as Ie,a8 as ma,a9 as ze,w as Pe,o as ta,P as Se,a0 as Ee,aa as Ye,$ as la,j as pa,k as Ce,ab as na,p as ya,ac as va,a1 as ha,F as fa,ad as ga}from"./index-BZVgHBzg.js";import{Q as de,a as le}from"./QCard-D0tZ7yHj.js";import{a as oe,b as oa,c as Ke}from"./QCheckbox-kJtdslv-.js";import{m as ue,u as ke,A as _a,a as ba,L as Ge,D as wa,S as Ta}from"./matchService-CFjhJkcG.js";import{S as B,E as T,F as $,P as H}from"./graphql-BhlZu-4f.js";import{h as Ne}from"./use-prevent-scroll-BbbWExSu.js";import{Q as J}from"./QTooltip-B-_vuAkl.js";import{Q as Sa}from"./QBadge-xr6i0LT-.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Be}from"./vue-i18n.runtime-CVTwj1XO.js";import{T as Ia}from"./TeamLogo-9dGw9St7.js";import{Q as ka,a as we}from"./QForm-qv8gwfMA.js";import{g as Me,u as ra}from"./players-KWIeNrLV.js";import{Q as Ve,a as te,b as X,c as K}from"./QList-D3ocQIFI.js";import{Q as Xe}from"./QRating-BkduVkbR.js";import{u as sa,a as ia}from"./use-dark-Dpk_N_Bo.js";import{u as $a}from"./use-quasar-CuxmfxlY.js";import{g as Ue}from"./index-C5X_dtXV.js";import"./format-DCP4FhDH.js";import"./private.use-form-BQ22Z5kX.js";import"./scroll-BysqonEL.js";import"./teamService-Bh3QS2lD.js";const La=x({__name:"MatchBadge",props:{color:{}},setup(n){return(e,a)=>(_(),R(Sa,{color:e.color,class:"match-badge"},{default:o(()=>[ca(e.$slots,"default",{},void 0,!0)]),_:3},8,["color"]))}}),Je=ee(La,[["__scopeId","data-v-a6da57b4"]]),Fa={class:"row items-center justify-between"},Pa={class:"col-auto"},Ea={key:0,class:"col-auto"},Ca={key:1,class:"row items-center q-gutter-sm"},Ma=x({__name:"MatchHeader",props:{status:{},isAdmin:{type:Boolean},editable:{type:Boolean}},emits:["update:status"],setup(n,{emit:e}){const{t:a}=Be(),c=n,S=e,s=G(!1),f=G(c.status),v=F=>{switch(F){case B.Scheduled:return a("matches.status.scheduled");case B.InProgress:return a("matches.status.live");case B.Completed:return a("matches.status.finished");case B.Postponed:return a("matches.status.postponed");case B.Cancelled:return a("matches.status.cancelled");default:return a("common.unknown")}},m=F=>{switch(F){case B.Scheduled:return"blue";case B.InProgress:return"red";case B.Completed:return"green";case B.Postponed:return"orange";case B.Cancelled:return"grey";default:return"grey"}},i=O(()=>Object.values(B).map(F=>({label:v(F),value:F}))),w=()=>{c.editable&&(s.value=!0,f.value=c.status)},b=()=>{S("update:status",f.value),s.value=!1},p=()=>{f.value=c.status,s.value=!1},g=F=>{f.value=F};return(F,Y)=>(_(),C("div",Fa,[P("div",Pa,[t(Je,{color:m(F.status)},{default:o(()=>[M(k(v(F.status)),1)]),_:1},8,["color"]),F.status===E(B).InProgress?(_(),R(Je,{key:0,color:"red",class:"q-ml-xs"},{default:o(()=>[M(k(F.$t("matches.live")),1)]),_:1})):V("",!0)]),F.isAdmin&&F.editable?(_(),C("div",Ea,[s.value?(_(),C("div",Ca,[t(oe,{modelValue:f.value,"onUpdate:modelValue":[Y[0]||(Y[0]=z=>f.value=z),g],options:i.value,dense:"",outlined:"",class:"col-auto"},null,8,["modelValue","options"]),t(N,{flat:"",round:"",color:"positive",icon:"check",onClick:b},{default:o(()=>[t(J,null,{default:o(()=>[M(k(F.$t("common.save")),1)]),_:1})]),_:1}),t(N,{flat:"",round:"",color:"negative",icon:"close",onClick:p},{default:o(()=>[t(J,null,{default:o(()=>[M(k(F.$t("common.cancel")),1)]),_:1})]),_:1})])):(_(),R(N,{key:0,flat:"",round:"",color:"primary",icon:"edit",onClick:w},{default:o(()=>[t(J,null,{default:o(()=>[M(k(F.$t("matches.editDetails")),1)]),_:1})]),_:1}))])):V("",!0)]))}}),qa=ee(Ma,[["__scopeId","data-v-b45ce121"]]),Ra={class:"team-display text-center"},Va={class:"text-h6 text-weight-bold"},Aa=x({__name:"TeamDisplay",props:{team:{},logoSize:{default:"80px"}},setup(n){return(e,a)=>{var c,S;return _(),C("div",Ra,[t(Ia,{"team-id":(c=e.team)==null?void 0:c.id,size:e.logoSize||"80px",class:"q-mb-sm"},null,8,["team-id","size"]),P("div",Va,k((S=e.team)==null?void 0:S.name),1),e.team?(_(),R(N,{key:0,flat:"","no-caps":"",color:"primary",to:`/teams/${e.team.id}`,label:e.$t("teams.viewTeam"),class:"q-mt-sm"},null,8,["to","label"])):V("",!0)])}}}),We=ee(Aa,[["__scopeId","data-v-c07781da"]]),Da={class:"match-score text-center"},Ga={key:0,class:"text-h3 text-weight-bold"},Na={key:1,class:"text-h3 text-weight-bold text-grey"},Ba={class:"text-subtitle1 q-mt-sm"},Ua={key:2,class:"text-caption"},Qa=x({__name:"MatchScore",props:{homeScore:{},awayScore:{},status:{},formattedDate:{},stadium:{}},setup(n){const e=n,a=O(()=>e.status===B.InProgress||e.status===B.Completed);return(c,S)=>(_(),C("div",Da,[a.value?(_(),C("div",Ga,k(c.homeScore)+" - "+k(c.awayScore),1)):(_(),C("div",Na,k(c.$t("matches.vs")),1)),P("div",Ba,k(c.formattedDate),1),c.stadium?(_(),C("div",Ua,k(c.stadium),1)):V("",!0)]))}}),Oa=ee(Qa,[["__scopeId","data-v-e15dd131"]]),Ha={class:"dice-rating"},ja=x({__name:"DiceRating",props:{modelValue:{},editable:{type:Boolean}},emits:["update:modelValue"],setup(n,{emit:e}){const a=n,c=e,S=O({get:()=>a.modelValue,set:v=>c("update:modelValue",v)}),s=O(()=>S.value?"primary":"grey"),f=()=>{a.editable&&(S.value&&S.value<6?S.value++:S.value=1)};return(v,m)=>(_(),C("div",Ha,[t(ea,{name:"casino",color:s.value,size:"24px",class:Re({"cursor-pointer":v.editable}),onClick:f},{default:o(()=>[t(J,null,{default:o(()=>[M(k(S.value||v.$t("rating.clickToRate")),1)]),_:1})]),_:1},8,["color","class"])]))}}),za=ee(ja,[["__scopeId","data-v-0d3c2b79"]]),Ya={class:"match-detail-header"},Ka={class:"row items-center q-col-gutter-lg"},Xa={class:"col-xs-12 col-sm-5"},Ja={class:"col-xs-12 col-sm-2"},Wa={class:"row justify-center q-mt-sm"},Za={class:"col-xs-12 col-sm-5"},xa=x({__name:"MatchDetailHeader",props:{match:{},editable:{type:Boolean}},emits:["update:match"],setup(n,{emit:e}){const a=n,c=Ae(),S=O(()=>c.isAuthenticated),s=e,f=i=>{s("update:match",{...a.match,rating:i})},v=i=>{s("update:match",{...a.match,status:i})},m=i=>{if(!i)return"N/A";try{const w=new Date(i);return w.setHours(w.getHours()+1),w.toLocaleString("nb-NO",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}).replace("kl.","").replace(", ",`
`).trim()}catch{return i}};return(i,w)=>(_(),C("div",Ya,[t(de,{flat:"",bordered:""},{default:o(()=>[t(le,null,{default:o(()=>[t(qa,{status:i.match.status,"is-admin":S.value,editable:i.editable,"onUpdate:status":v},null,8,["status","is-admin","editable"])]),_:1}),t(Ne),t(le,null,{default:o(()=>{var b,p;return[P("div",Ka,[P("div",Xa,[t(We,{team:i.match.homeTeam},null,8,["team"])]),P("div",Ja,[t(Oa,{"home-score":(b=i.match.score)==null?void 0:b.homeTeamScore,"away-score":(p=i.match.score)==null?void 0:p.awayTeamScore,status:i.match.status,"formatted-date":m(i.match.scheduledDate)},null,8,["home-score","away-score","status","formatted-date"]),P("div",Wa,[t(za,{"model-value":i.match.rating,editable:i.editable,"onUpdate:modelValue":f},null,8,["model-value","editable"])])]),P("div",Za,[t(We,{team:i.match.awayTeam},null,8,["team"])])])]}),_:1})]),_:1})]))}}),et=ee(xa,[["__scopeId","data-v-e2d4f35c"]]),at={class:"match-event-form"},tt={class:"text-h6"},lt={class:"row q-col-gutter-md"},nt={class:"col-6"},ot={class:"col-6"},rt={class:"row justify-end q-gutter-sm"},st=x({__name:"MatchEventForm",props:{match:{},eventType:{}},emits:["event-added","cancel"],setup(n,{emit:e}){const a=n,c=e,S=G(null),s=G(null),f=G(null),v=G(null),m=G(null),i=G(null),w=G(null),b=G(null),p=G(!1),{t:g}=Be();a.match.score&&(w.value=a.match.score.homeTeamScore,b.value=a.match.score.awayTeamScore);const F=O(()=>{switch(a.eventType){case T.Goal:return g("matches.events.addGoal");case T.OwnGoal:return g("matches.events.addOwnGoal");case T.YellowCard:return g("matches.events.addYellowCard");case T.RedCard:return g("matches.events.addRedCard");case T.Substitution:return g("matches.events.addSubstitution");case T.HalfTimeStart:return g("matches.events.addHalftime");case T.GameEnd:return g("matches.events.endGame");default:return g("matches.events.addEvent")}}),Y=A=>{const q=A===a.match.homeTeamId?a.match.homeTeamLineup:a.match.awayTeamLineup;return(q==null?void 0:q.players.map(W=>W.player).filter(W=>W!==null))||[]},z=A=>{const Z=(a.eventType===T.OwnGoal?A===a.match.homeTeamId?a.match.awayTeamId:a.match.homeTeamId:A)===a.match.homeTeamId?a.match.homeTeamLineup:a.match.awayTeamLineup;return(Z==null?void 0:Z.players.map(I=>I.player).filter(I=>I!==null))||[]},$e=O(()=>{switch(a.eventType){case T.Goal:case T.OwnGoal:return g("matches.events.goalscorer");case T.Substitution:return g("matches.events.substituteOut");case T.YellowCard:case T.RedCard:return g("matches.events.player");default:return g("matches.events.player")}}),Le=async()=>{var A,q,W,Z,I,ve,he;if(a.eventType===T.GameEnd){if(!i.value||w.value===null||b.value===null)return}else if(a.eventType===T.HalfTimeStart){if(!i.value)return}else if(!S.value||!s.value||!f.value)return;p.value=!0;try{const{addMatchEvent:pe}=ue.useAddMatchEvent();if(a.eventType===T.Goal||a.eventType===T.OwnGoal){const ce=((A=s.value)==null?void 0:A.id)===a.match.homeTeamId,ae=((q=a.match.score)==null?void 0:q.homeTeamScore)||0,fe=((W=a.match.score)==null?void 0:W.awayTeamScore)||0;a.eventType===T.Goal?ce?w.value=ae+1:b.value=fe+1:ce?b.value=fe+1:w.value=ae+1}const Fe=await pe({matchId:a.match.id,type:a.eventType,minuteOfMatch:a.eventType===T.HalfTimeStart?45:S.value,playerId:a.eventType===T.HalfTimeStart||(Z=f.value)==null?void 0:Z.id,teamId:a.eventType===T.HalfTimeStart||(I=s.value)==null?void 0:I.id,secondaryPlayerId:a.eventType===T.Substitution?(ve=m.value)==null?void 0:ve.id:a.eventType===T.Goal||a.eventType===T.OwnGoal?(he=v.value)==null?void 0:he.id:void 0,description:a.eventType===T.HalfTimeStart||a.eventType===T.GameEnd?`Added minutes: ${i.value}`:void 0,timestamp:new Date().toISOString()});if(a.eventType===T.Goal||a.eventType===T.OwnGoal||a.eventType===T.GameEnd){const{updateMatchScore:ce}=ue.useUpdateMatchScore();await ce(a.match.id,{homeTeamScore:w.value,awayTeamScore:b.value})}c("event-added",Fe)}catch(pe){console.error("Error adding match event:",pe)}finally{p.value=!1}};return(A,q)=>(_(),C("div",at,[t(de,{flat:"",bordered:""},{default:o(()=>[t(le,null,{default:o(()=>[P("div",tt,k(F.value),1)]),_:1}),t(Ne),t(le,null,{default:o(()=>[t(ka,{onSubmit:Le,class:"q-gutter-md"},{default:o(()=>{var W,Z;return[A.eventType!==E(T).HalfTimeStart?(_(),R(we,{key:0,modelValue:S.value,"onUpdate:modelValue":q[0]||(q[0]=I=>S.value=I),modelModifiers:{number:!0},type:"number",label:"Minute",rules:[I=>!!I||"Minute is required",I=>I>=0||"Minute must be positive",I=>I<=120||"Minute must be less than 120"],outlined:""},null,8,["modelValue","rules"])):V("",!0),A.eventType!==E(T).HalfTimeStart&&A.eventType!==E(T).GameEnd?(_(),R(oe,{key:1,modelValue:s.value,"onUpdate:modelValue":q[1]||(q[1]=I=>s.value=I),options:[A.match.homeTeam,A.match.awayTeam],"option-label":"name",label:"Team",rules:[I=>!!I||"Team is required"],outlined:""},null,8,["modelValue","options","rules"])):V("",!0),s.value&&A.eventType!==E(T).HalfTimeStart&&A.eventType!==E(T).GameEnd?(_(),R(oe,{key:2,modelValue:f.value,"onUpdate:modelValue":q[2]||(q[2]=I=>f.value=I),options:Y(s.value.id),"option-label":E(Me),label:$e.value,rules:[I=>!!I||"Player is required"],outlined:""},null,8,["modelValue","options","option-label","label","rules"])):V("",!0),s.value&&(A.eventType===E(T).Goal||A.eventType===E(T).OwnGoal)?(_(),R(oe,{key:3,modelValue:v.value,"onUpdate:modelValue":q[3]||(q[3]=I=>v.value=I),options:z(s.value.id),"option-label":E(Me),label:"Assist (optional)",outlined:""},null,8,["modelValue","options","option-label"])):V("",!0),A.eventType===E(T).Substitution&&s.value?(_(),R(oe,{key:4,modelValue:m.value,"onUpdate:modelValue":q[4]||(q[4]=I=>m.value=I),options:Y(s.value.id),"option-label":E(Me),label:"Substitute In",rules:[I=>!!I||"Substitute player is required"],outlined:""},null,8,["modelValue","options","option-label","rules"])):V("",!0),A.eventType===E(T).HalfTimeStart||A.eventType===E(T).GameEnd?(_(),R(we,{key:5,modelValue:i.value,"onUpdate:modelValue":q[5]||(q[5]=I=>i.value=I),modelModifiers:{number:!0},type:"number",label:"Added Minutes",rules:[I=>!!I||"Added minutes is required",I=>I>=0||"Added minutes must be positive",I=>I<=99||"Added minutes must be less than 100"],outlined:""},null,8,["modelValue","rules"])):V("",!0),A.eventType===E(T).GameEnd?(_(),C(ie,{key:6},[q[9]||(q[9]=P("div",{class:"text-subtitle1 q-mt-md"},"Final Score",-1)),P("div",lt,[P("div",nt,[t(we,{modelValue:w.value,"onUpdate:modelValue":q[6]||(q[6]=I=>w.value=I),modelModifiers:{number:!0},type:"number",label:(W=A.match.homeTeam)==null?void 0:W.name,rules:[I=>!!I||"Score is required",I=>I>=0||"Score must be positive"],outlined:""},null,8,["modelValue","label","rules"])]),P("div",ot,[t(we,{modelValue:b.value,"onUpdate:modelValue":q[7]||(q[7]=I=>b.value=I),modelModifiers:{number:!0},type:"number",label:(Z=A.match.awayTeam)==null?void 0:Z.name,rules:[I=>!!I||"Score is required",I=>I>=0||"Score must be positive"],outlined:""},null,8,["modelValue","label","rules"])])])],64)):V("",!0),P("div",rt,[t(N,{label:"Cancel",color:"negative",onClick:q[8]||(q[8]=I=>A.$emit("cancel"))}),t(N,{label:"Add Event",type:"submit",color:"primary",loading:p.value},null,8,["loading"])])]}),_:1})]),_:1})]),_:1})]))}}),ua=ee(st,[["__scopeId","data-v-a274db05"]]),it={class:"match-event-bar"},ut=x({__name:"MatchEventBar",props:{match:{}},emits:["update:match"],setup(n,{emit:e}){const a=n,c=e,S=G(!1),s=G(null),f=O(()=>{var p;return(p=a.match.events)==null?void 0:p.some(g=>g.type===T.HalfTimeStart)}),v=p=>{s.value=p,S.value=!0},m=async()=>{try{const{updateMatchStatus:p}=ue.useUpdateMatchStatus();await p(a.match.id,B.InProgress),c("update:match",{...a.match,status:B.InProgress})}catch(p){console.error("Error starting match:",p)}},i=async()=>{try{const{updateMatchStatus:p}=ue.useUpdateMatchStatus();await p(a.match.id,B.InProgress),c("update:match",{...a.match,status:B.InProgress})}catch(p){console.error("Error resuming match:",p)}},w=()=>{s.value=T.GameEnd,S.value=!0},b=async()=>{S.value=!1,s.value=null;try{const{updateMatchStatus:p}=ue.useUpdateMatchStatus();await p(a.match.id,B.Completed),c("update:match",{...a.match,status:B.Completed})}catch(p){console.error("Error ending match:",p)}};return(p,g)=>(_(),C("div",it,[t(de,{flat:"",bordered:""},{default:o(()=>[t(le,{class:"row items-center justify-center q-gutter-md"},{default:o(()=>[p.match.status===E(B).Scheduled?(_(),R(N,{key:0,flat:"",round:"",color:"primary",icon:"play_arrow",onClick:m},{default:o(()=>[t(J,null,{default:o(()=>[M(k(p.$t("matches.startMatch")),1)]),_:1})]),_:1})):p.match.status===E(B).InProgress?(_(),C(ie,{key:1},[f.value?(_(),R(N,{key:1,flat:"",round:"",color:"primary",icon:"play_arrow",onClick:i},{default:o(()=>[t(J,null,{default:o(()=>[M(k(p.$t("matches.resumeMatch")),1)]),_:1})]),_:1})):(_(),C(ie,{key:0},[t(N,{flat:"",round:"",color:"positive",icon:"sports_soccer",onClick:g[0]||(g[0]=F=>v(E(T).Goal))},{default:o(()=>[t(J,null,{default:o(()=>[M(k(p.$t("matches.addGoal")),1)]),_:1})]),_:1}),t(N,{flat:"",round:"",color:"negative",icon:"sports_soccer",onClick:g[1]||(g[1]=F=>v(E(T).OwnGoal))},{default:o(()=>[t(J,null,{default:o(()=>[M(k(p.$t("matches.addOwnGoal")),1)]),_:1})]),_:1}),t(N,{flat:"",round:"",color:"warning",icon:"square",onClick:g[2]||(g[2]=F=>v(E(T).YellowCard))},{default:o(()=>[t(J,null,{default:o(()=>[M(k(p.$t("matches.addYellowCard")),1)]),_:1})]),_:1}),t(N,{flat:"",round:"",color:"negative",icon:"square",onClick:g[3]||(g[3]=F=>v(E(T).RedCard))},{default:o(()=>[t(J,null,{default:o(()=>[M(k(p.$t("matches.addRedCard")),1)]),_:1})]),_:1}),t(N,{flat:"",round:"",color:"info",icon:"swap_vert",onClick:g[4]||(g[4]=F=>v(E(T).Substitution))},{default:o(()=>[t(J,null,{default:o(()=>[M(k(p.$t("matches.addSubstitution")),1)]),_:1})]),_:1}),t(N,{flat:"",round:"",color:"grey",icon:"timer",onClick:g[5]||(g[5]=F=>v(E(T).HalfTimeStart))},{default:o(()=>[t(J,null,{default:o(()=>[M(k(p.$t("matches.addHalftime")),1)]),_:1})]),_:1})],64)),t(N,{flat:"",round:"",color:"negative",icon:"stop",onClick:w},{default:o(()=>[t(J,null,{default:o(()=>[M(k(p.$t("matches.endMatch")),1)]),_:1})]),_:1})],64)):V("",!0)]),_:1})]),_:1}),t(oa,{modelValue:S.value,"onUpdate:modelValue":g[7]||(g[7]=F=>S.value=F),persistent:""},{default:o(()=>[t(de,{style:{"min-width":"500px"}},{default:o(()=>[t(ua,{match:p.match,"event-type":s.value,onEventAdded:b,onCancel:g[6]||(g[6]=F=>S.value=!1)},null,8,["match","event-type"])]),_:1})]),_:1},8,["modelValue"])]))}}),dt=ee(ut,[["__scopeId","data-v-38eee1d4"]]),ct=De({name:"QBanner",props:{...sa,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(n,{slots:e}){const{proxy:{$q:a}}=aa(),c=ia(n,a),S=O(()=>"q-banner row items-center"+(n.dense===!0?" q-banner--dense":"")+(c.value===!0?" q-banner--dark q-dark":"")+(n.rounded===!0?" rounded-borders":"")),s=O(()=>`q-banner__actions row items-center justify-end col-${n.inlineActions===!0?"auto":"all"}`);return()=>{const f=[j("div",{class:"q-banner__avatar col-auto row items-center self-start"},me(e.avatar)),j("div",{class:"q-banner__content col text-body2"},me(e.default))],v=me(e.action);return v!==void 0&&f.push(j("div",{class:s.value},v)),j("div",{class:S.value+(n.inlineActions===!1&&v!==void 0?" q-banner--top-padding":""),role:"alert"},f)}}}),qe={isRating:G(!1),async startRatingMode(n){console.log("Starting rating mode"),this.isRating.value=!0;const e=n.filter(a=>a.playerId?parseInt(a.position)<=11:!1);await Promise.all(e.map(async a=>{try{console.log("Setting default rating for starting player:",a.playerId),await this.savePlayerRating(a.playerId,5)}catch(c){console.error("Error setting default rating for player:",a.playerId,c)}}))},stopRatingMode(){console.log("Stopping rating mode"),this.isRating.value=!1},async savePlayerRating(n,e){try{console.log("Saving rating for player:",n,"rating:",e),await this.useAddSimpleRating().addSimpleRating(n,e)}catch(a){throw console.error("Error updating player rating:",a),a}},async updatePlayerRating(n,e){console.log("Updating rating for player:",n,"rating:",e),await this.savePlayerRating(n,e)},async removePlayerRating(n){console.log("Removing rating for player:",n),await this.savePlayerRating(n,0)},getPlayerRating(n,e){const a=e.find(c=>c.playerId===n);return a?a.ratings[a.ratings.length-1].score:0},useAddRating(){const{mutate:n,loading:e,error:a}=Ie(ba),c=ke();return{addRating:async s=>{var f,v;try{console.log("Adding rating with input:",s);const m=await n({input:s});if(console.log("Rating result:",m),(f=m==null?void 0:m.data)!=null&&f.addRating){const i=c.matches.findIndex(w=>{var b,p;return((b=w.homeTeamLineup)==null?void 0:b.players.some(g=>g.id===s.matchPlayerId))||((p=w.awayTeamLineup)==null?void 0:p.players.some(g=>g.id===s.matchPlayerId))});if(i!==-1){const w=c.matches[i];if(w.homeTeamLineup){const b=w.homeTeamLineup.players.findIndex(p=>p.id===s.matchPlayerId);b!==-1&&(w.homeTeamLineup.players[b].ratings||(w.homeTeamLineup.players[b].ratings=[]),w.homeTeamLineup.players[b].ratings.push(m.data.addRating))}if(w.awayTeamLineup){const b=w.awayTeamLineup.players.findIndex(p=>p.id===s.matchPlayerId);b!==-1&&(w.awayTeamLineup.players[b].ratings||(w.awayTeamLineup.players[b].ratings=[]),w.awayTeamLineup.players[b].ratings.push(m.data.addRating))}}}return(v=m==null?void 0:m.data)==null?void 0:v.addRating}catch(m){throw console.error("Error adding rating:",m),m}},loading:e,error:a}},useAddSimpleRating(){const{mutate:n,loading:e,error:a}=Ie(_a),c=ke();return{addSimpleRating:async(s,f)=>{var v,m;try{const i=await n({matchPlayerId:s,score:f});if((v=i==null?void 0:i.data)!=null&&v.addSimpleRating){const w=c.matches.findIndex(b=>{var p,g;return((p=b.homeTeamLineup)==null?void 0:p.players.some(F=>F.id===s))||((g=b.awayTeamLineup)==null?void 0:g.players.some(F=>F.id===s))});if(w!==-1){const b=c.matches[w];if(b.homeTeamLineup){const p=b.homeTeamLineup.players.findIndex(g=>g.id===s);p!==-1&&(b.homeTeamLineup.players[p].ratings||(b.homeTeamLineup.players[p].ratings=[]),b.homeTeamLineup.players[p].ratings.push(i.data.addSimpleRating))}if(b.awayTeamLineup){const p=b.awayTeamLineup.players.findIndex(g=>g.id===s);p!==-1&&(b.awayTeamLineup.players[p].ratings||(b.awayTeamLineup.players[p].ratings=[]),b.awayTeamLineup.players[p].ratings.push(i.data.addSimpleRating))}}}return(m=i==null?void 0:i.data)==null?void 0:m.addSimpleRating}catch(i){throw console.error("Error adding simple rating:",i),i}},loading:e,error:a}},getRatingColor(n){return n>=9||n>=8||n>=7?"positive":n>=6||n>=5?"warning":(n>=4||n>=3,"negative")}},Te=ma("lineup",{state:()=>({lineups:{},loading:!1,error:null}),getters:{getLineupByTeamAndMatch:n=>(e,a)=>Object.values(n.lineups).find(c=>c.teamId===e&&c.matchId===a),getLineupById:n=>e=>n.lineups[e]},actions:{setLineup(n){n.id&&(this.lineups[String(n.id)]=n)},setLoading(n){this.loading=n},setError(n){this.error=n},clearError(){this.error=null},removeLineup(n){delete this.lineups[n]}}});Ue`
  query GetMatchLineups($filter: MatchFilterInput) {
    matches(first: 1, where: $filter) {
      nodes {
        ...LineupFields
      }
    }
  }
  ${Ge}
`;const mt=Ue`
  query GetLineup($id: String!) {
    lineup(id: $id) {
      ...LineupFields
    }
  }
  ${Ge}
`,pt=Ue`
  query GetTeamLineups($teamId: String!, $matchId: String) {
    teamLineups(teamId: $teamId, matchId: $matchId) {
      nodes {
        ...LineupFields
      }
    }
  }
  ${Ge}
`,yt={useLineup(n){var f;const{result:e,loading:a,error:c,refetch:S}=ze(mt,{id:n}),s=Te();return(f=e.value)!=null&&f.lineup&&s.setLineup(e.value.lineup),{lineup:e,loading:a,error:c,refetch:S}},useTeamLineups(n,e){var v;const{result:a,loading:c,error:S,refetch:s}=ze(pt,{teamId:n,matchId:e}),f=Te();return(v=a.value)!=null&&v.teamLineups&&a.value.teamLineups.forEach(m=>{f.setLineup(m)}),{lineups:a,loading:c,error:S,refetch:s}},useSaveLineup(){const{mutate:n,loading:e,error:a}=Ie(Ta),c=Te(),S=ke();return{saveLineup:async f=>{var v,m;try{const i=await n({lineup:f});if((v=i==null?void 0:i.data)!=null&&v.saveLineup){const w=i.data.saveLineup;c.setLineup(w);const b=S.matches.findIndex(p=>p.id===f.matchId);if(b!==-1){const p=S.matches[b],g={...p,homeTeamLineupId:p.homeTeamId===f.teamId?w.id:p.homeTeamLineupId,awayTeamLineupId:p.awayTeamId===f.teamId?w.id:p.awayTeamLineupId,homeTeamLineup:p.homeTeamId===f.teamId?w:p.homeTeamLineup,awayTeamLineup:p.awayTeamId===f.teamId?w:p.awayTeamLineup};S.updateMatch(g)}}return(m=i==null?void 0:i.data)==null?void 0:m.saveLineup}catch(i){throw console.error("Error saving lineup:",i),i}},loading:e,error:a}},useDeleteLineup(){const{mutate:n,loading:e,error:a}=Ie(wa),c=Te(),S=ke();return{deleteLineup:async f=>{var v,m;try{const i=await n({id:f});if((v=i==null?void 0:i.data)!=null&&v.deleteLineup){c.removeLineup(f);const w=S.matches.findIndex(b=>b.homeTeamLineupId===f||b.awayTeamLineupId===f);if(w!==-1){const b=S.matches[w],p={...b,homeTeamLineupId:b.homeTeamLineupId===f?null:b.homeTeamLineupId,awayTeamLineupId:b.awayTeamLineupId===f?null:b.awayTeamLineupId,homeTeamLineup:b.homeTeamLineupId===f?null:b.homeTeamLineup,awayTeamLineup:b.awayTeamLineupId===f?null:b.awayTeamLineup};S.updateMatch(p)}}return(m=i==null?void 0:i.data)==null?void 0:m.deleteLineup}catch(i){throw console.error("Error deleting lineup:",i),i}},loading:e,error:a}}},vt={class:"lineup"},ht={key:0,class:"text-caption q-mb-sm"},ft={key:1,class:"row q-col-gutter-md"},gt={class:"col-12"},_t={class:"row items-center justify-between"},bt={class:"text-h6"},wt={class:"text-subtitle2"},Tt={class:"row q-gutter-sm"},St={class:"text-subtitle2 q-mb-sm"},It={key:1,class:"row items-center justify-between"},kt={class:"col"},$t={class:"row items-center"},Lt={class:"text-subtitle2 q-mt-md q-mb-sm"},Ft={class:"row items-center justify-between"},Pt={class:"col"},Et={class:"row items-center"},Ct={key:1,class:"row q-col-gutter-md q-mt-md"},Mt={class:"col-6"},qt={class:"col-6"},Rt={class:"col-12"},Vt={class:"col-12"},At=x({__name:"LineupCard",props:{matchId:{},team:{},loading:{type:Boolean},lineup:{}},setup(n){var je;const e=n,a=ra(),c=Ae(),S=O(()=>c.isAdmin),s=a.playersByTeam[e.team.id]||[],f=[{label:"Custom",value:$.FormationCustom},{label:"4-4-2",value:$.Formation442},{label:"4-3-3",value:$.Formation433},{label:"3-5-2",value:$.Formation352},{label:"3-4-3",value:$.Formation343},{label:"4-2-3-1",value:$.Formation4231},{label:"4-3-2-1",value:$.Formation4321},{label:"5-3-2",value:$.Formation532},{label:"5-4-1",value:$.Formation541},{label:"4-5-1",value:$.Formation451},{label:"5-2-3",value:$.Formation523},{label:"4-1-4-1",value:$.Formation4141},{label:"3-1-4-2",value:$.Formation3142}],v=G($.Formation442);(je=e.lineup)!=null&&je.formation&&(v.value=e.lineup.formation);const m=G([]),i=G([]),w=G(!1),b=G(null),p=G($.Formation442),g=$a(),F=G(!1),Y=G(!1),z=G(!1),$e=()=>{b.value=e.lineup?{...e.lineup}:null,p.value=v.value,w.value=!0},Le=()=>{b.value&&(v.value=p.value,A()),w.value=!1},A=()=>{if(e.lineup){m.value.forEach(r=>r.player=null),i.value.forEach(r=>r.player=null);for(const r of e.lineup.players){if(!r.player){console.warn("Skipping match player with no player data:",r);continue}const d=parseInt(r.position);if(isNaN(d)){console.warn("Invalid position number:",r.position);continue}if(d<=11){const y=m.value.find(l=>l.number===d);y?y.player=r:console.warn(`Could not find position ${d} in starting positions. Available positions:`,m.value.map(l=>l.number))}else{const y=i.value.find(l=>l.number===d);y?y.player=r:console.warn(`Could not find substitute position ${d}. Available substitute positions:`,i.value.map(l=>l.number))}}}},q=()=>{m.value=Array.from({length:11},(u,D)=>({number:D+1,role:H.Goalkeeper,player:null}));const r=v.value;let d=4,y=4,l=2;switch(r){case $.FormationCustom:d=0,y=0,l=0;break;case $.Formation442:d=4,y=4,l=2;break;case $.Formation433:d=4,y=3,l=3;break;case $.Formation352:d=3,y=5,l=2;break;case $.Formation343:d=3,y=4,l=3;break;case $.Formation4231:d=4,y=2,l=3;break;case $.Formation4321:d=4,y=3,l=2;break;case $.Formation532:d=5,y=3,l=2;break;case $.Formation541:d=5,y=4,l=1;break;case $.Formation451:d=4,y=5,l=1;break;case $.Formation523:d=5,y=2,l=3;break;case $.Formation4141:d=4,y=1,l=4;break;case $.Formation3142:d=3,y=1,l=4;break}let h=1;for(let u=0;u<d;u++)m.value[h].role=H.Defender,h++;for(let u=0;u<y;u++)m.value[h].role=H.Midfielder,h++;for(let u=0;u<l;u++)m.value[h].role=H.Forward,h++;if(r===$.FormationCustom)for(;h<m.value.length;)m.value[h].role=H.Undefined,h++;i.value=Array.from({length:7},(u,D)=>({number:12+D,player:null}))};Pe(v,()=>{q()}),Pe(()=>e.lineup,r=>{var d;r&&(v.value=r.formation,q(),((d=a.playersByTeam[e.team.id])==null?void 0:d.length)>0&&A())},{immediate:!0}),Pe(()=>a.playersByTeam[e.team.id],r=>{r&&r.length>0&&e.lineup&&A()},{immediate:!0}),ta(async()=>{if(q(),e.team&&(!a.playersByTeam[e.team.id]||a.playersByTeam[e.team.id].length===0))try{await a.fetchPlayersByTeam(e.team.id),e.lineup&&A()}catch(r){console.error("Failed to fetch team players:",r)}});const W=()=>{var r,d,y,l;return{id:((r=e.lineup)==null?void 0:r.id)||"",teamId:e.team.id,matchId:e.matchId,formation:v.value,players:[...m.value.filter(h=>h.player!==null).map(h=>{var u;return{id:h.player.id,playerId:h.player.playerId,lineupId:((u=e.lineup)==null?void 0:u.id)||"",isStarter:!0,position:h.number.toString(),teamId:e.team.id,ratings:h.player.ratings,averageRating:h.player.averageRating}}),...i.value.filter(h=>h.player!==null).map(h=>{var u;return{id:h.player.id,playerId:h.player.playerId,lineupId:((u=e.lineup)==null?void 0:u.id)||"",isStarter:!1,position:h.number.toString(),teamId:e.team.id,ratings:h.player.ratings,averageRating:h.player.averageRating}})],createdAt:((d=e.lineup)==null?void 0:d.createdAt)||new Date().toISOString(),updatedAt:((y=e.lineup)==null?void 0:y.updatedAt)||new Date().toISOString(),isStarting:((l=e.lineup)==null?void 0:l.isStarting)||!0}},Z=r=>{const d=a.playersByTeam[e.team.id]||[],y=new Set([...m.value.filter(l=>l.player).map(l=>l.player.playerId),...i.value.filter(l=>l.player).map(l=>l.player.playerId)]);return r===H.Undefined?d.filter(l=>!y.has(l.id)).map(l=>{var h;return{id:"",playerId:l.id,lineupId:((h=e.lineup)==null?void 0:h.id)||"",isStarter:!0,position:r.toString(),teamId:e.team.id,player:l}}):d.filter(l=>r===l.position).filter(l=>!y.has(l.id)).map(l=>{var h;return{id:"",playerId:l.id,lineupId:((h=e.lineup)==null?void 0:h.id)||"",isStarter:!0,position:r.toString(),teamId:e.team.id,player:l}})},I=O(()=>{const r=m.value.filter(y=>y.player).length,d=i.value.filter(y=>y.player).length;return{is_valid:r===11&&d<=8,starting_count:r,substitute_count:d,message:r<11?`Need ${11-r} more starting players`:r>11?"Too many starting players":d>8?"Too many substitutes":"Valid lineup"}}),ve=(r,d)=>{d&&!He(d.playerId,r+1)||(m.value[r].player=d)},he=(r,d)=>{I.value.substitute_count>=8&&!i.value[r].player||d&&!He(d.playerId,12+r)||(i.value[r].player=d)},pe=async()=>{var U;if(console.log("Starting auto-fill with team players:",s),!s.length){console.log("No players loaded, fetching team players...");try{await a.fetchPlayersByTeam(e.team.id)}catch(Q){console.error("Failed to fetch team players:",Q);return}}const r=[...a.playersByTeam[e.team.id]||[]];if(console.log("Available players:",r),!r.length){console.log("No players available for auto-fill");return}m.value.forEach(Q=>Q.player=null),i.value.forEach(Q=>Q.player=null);const d=r.find(Q=>Q.position===H.Goalkeeper);d&&(console.log("Found goalkeeper:",d),m.value[0].player={id:"",playerId:d.id,lineupId:((U=e.lineup)==null?void 0:U.id)||"",isStarter:!0,position:"1",teamId:e.team.id,player:d},r.splice(r.indexOf(d),1));const y=v.value;let l=4,h=4,u=2;switch(y){case $.Formation442:l=4,h=4,u=2;break;case $.Formation433:l=4,h=3,u=3;break;case $.Formation352:l=3,h=5,u=2;break;case $.Formation343:l=3,h=4,u=3;break;case $.Formation4231:l=4,h=2,u=3;break;case $.Formation4321:l=4,h=3,u=2;break;case $.Formation532:l=5,h=3,u=2;break;case $.Formation541:l=5,h=4,u=1;break;case $.Formation451:l=4,h=5,u=1;break;case $.Formation523:l=5,h=2,u=3;break;case $.Formation4141:l=4,h=1,u=4;break;case $.Formation3142:l=3,h=1,u=4;break}let D=1;const L=(Q,re)=>{var ne;for(let se=0;se<re&&D<m.value.length;se++){let ye=r.findIndex(be=>be.position===Q);if(ye===-1&&r.length>0&&(ye=0),ye!==-1){const be=r[ye];m.value[D].player={id:"",playerId:be.id,lineupId:((ne=e.lineup)==null?void 0:ne.id)||"",isStarter:!0,position:D.toString(),teamId:e.team.id,player:be},r.splice(ye,1),D++}}};L(H.Defender,l),L(H.Midfielder,h),L(H.Forward,u),i.value.forEach((Q,re)=>{var ne;if(r.length>0){const se=r.shift();se&&(Q.player={id:"",playerId:se.id,lineupId:((ne=e.lineup)==null?void 0:ne.id)||"",isStarter:!1,position:(12+re).toString(),teamId:e.team.id,player:se})}})},Fe=async()=>{if(!_e.value.isValid){g.notify({color:"negative",message:`Invalid formation. Expected: ${_e.value.expected.defenders}-${_e.value.expected.midfielders}-${_e.value.expected.forwards}`});return}try{F.value=!0;const r=W(),d=await yt.useSaveLineup().saveLineup(r);d&&(m.value.forEach(y=>{if(y.player){const l=d.players.find(h=>{var u;return h.playerId===((u=y.player)==null?void 0:u.playerId)});l&&(y.player={...y.player,id:l.id,lineupId:l.lineupId,player:y.player.player})}}),i.value.forEach(y=>{if(y.player){const l=d.players.find(h=>{var u;return h.playerId===((u=y.player)==null?void 0:u.playerId)});l&&(y.player={...y.player,id:l.id,lineupId:l.lineupId,player:y.player.player})}})),w.value=!1}finally{F.value=!1}},ce=r=>"firstName"in r&&"lastName"in r&&!("player"in r),ae=r=>r?"player"in r?`${r.player.firstName} ${r.player.lastName}`:ce(r)?`${r.firstName} ${r.lastName}`:"":"",fe=async()=>{var d;const r=m.value.map(y=>y.player).filter(y=>y!==null);console.log("Starting players:",r);for(const y of r)if(!y.ratings||y.ratings.length===0)try{const l=await qe.useAddSimpleRating().addSimpleRating(y.id,5);if((d=l==null?void 0:l.matchPlayer)!=null&&d.ratings){const h=m.value.find(u=>{var D;return((D=u.player)==null?void 0:D.id)===y.id});h!=null&&h.player&&(h.player={...h.player,ratings:l.matchPlayer.ratings,averageRating:l.matchPlayer.averageRating})}}catch(l){console.error("Error setting default rating for player:",l)}z.value=!0},da=()=>{z.value=!1},Qe=async(r,d)=>{var y;try{if(d<1||d>10){g.notify({color:"negative",message:"Rating must be between 1 and 10"});return}Y.value=!0;const l=await qe.useAddSimpleRating().addSimpleRating(r,d);if((y=l==null?void 0:l.matchPlayer)!=null&&y.ratings){const h=m.value.find(D=>{var L;return((L=D.player)==null?void 0:L.id)===r});h!=null&&h.player&&(h.player={...l.matchPlayer,player:h.player.player});const u=i.value.find(D=>{var L;return((L=D.player)==null?void 0:L.id)===r});u!=null&&u.player&&(u.player={...l.matchPlayer,player:u.player.player})}g.notify({color:"positive",message:"Rating updated successfully"})}catch(l){console.error("Error updating player rating:",l),g.notify({color:"negative",message:"Failed to update rating"})}finally{Y.value=!1}},ge=r=>{var d;return(d=r==null?void 0:r.ratings)!=null&&d.length?r.ratings[r.ratings.length-1].score:0},Oe=async r=>{try{Y.value=!0,await qe.removePlayerRating(r),g.notify({color:"positive",message:"Rating removed successfully"})}catch(d){console.error("Error removing player rating:",d),g.notify({color:"negative",message:"Failed to remove rating"})}finally{Y.value=!1}},He=(r,d)=>{const y=m.value.some(h=>{var u;return((u=h.player)==null?void 0:u.playerId)===r&&h.number!==d}),l=i.value.some(h=>{var u;return((u=h.player)==null?void 0:u.playerId)===r&&h.number!==d});return y||l?(g.notify({color:"negative",message:"Player is already selected in another position"}),!1):!0},_e=O(()=>{const r=v.value;if(r===$.FormationCustom)return{isValid:!0,expected:{defenders:0,midfielders:0,forwards:0},current:{defenders:m.value.filter(L=>L.role===H.Defender).length,midfielders:m.value.filter(L=>L.role===H.Midfielder).length,forwards:m.value.filter(L=>L.role===H.Forward).length}};let d=4,y=4,l=2;switch(r){case $.Formation442:d=4,y=4,l=2;break;case $.Formation433:d=4,y=3,l=3;break;case $.Formation352:d=3,y=5,l=2;break;case $.Formation343:d=3,y=4,l=3;break;case $.Formation4231:d=4,y=2,l=3;break;case $.Formation4321:d=4,y=3,l=2;break;case $.Formation532:d=5,y=3,l=2;break;case $.Formation541:d=5,y=4,l=1;break;case $.Formation451:d=4,y=5,l=1;break;case $.Formation523:d=5,y=2,l=3;break;case $.Formation4141:d=4,y=1,l=4;break;case $.Formation3142:d=3,y=1,l=4;break}const h=m.value.filter(L=>L.role===H.Defender).length,u=m.value.filter(L=>L.role===H.Midfielder).length,D=m.value.filter(L=>L.role===H.Forward).length;return{isValid:h===d&&u===y&&D===l,expected:{defenders:d,midfielders:y,forwards:l},current:{defenders:h,midfielders:u,forwards:D}}});return(r,d)=>{var y,l,h;return _(),C("div",vt,[w.value?(_(),C("div",ht," Lineup ID: "+k(((y=r.lineup)==null?void 0:y.id)||"None")+" Players: "+k(((h=(l=r.lineup)==null?void 0:l.players)==null?void 0:h.length)||0),1)):V("",!0),w.value?(_(),C("div",ft,[P("div",gt,[t(oe,{modelValue:v.value,"onUpdate:modelValue":d[0]||(d[0]=u=>v.value=u),options:f,label:"Formation",outlined:"",dense:"","emit-value":"","map-options":"",class:"q-mb-md"},null,8,["modelValue"])])])):V("",!0),r.team?(_(),R(de,{key:2},{default:o(()=>[t(le,{class:Re([[w.value?"bg-negative":"bg-primary"],"text-white"])},{default:o(()=>[P("div",_t,[P("div",null,[P("div",bt,k(r.team.name),1),P("div",wt,"Formation: "+k(v.value),1)]),P("div",Tt,[!w.value&&S.value?(_(),R(N,{key:0,color:"white","text-color":"primary",icon:"edit",label:"Edit Lineup",onClick:$e})):V("",!0),!w.value&&S.value&&!z.value?(_(),R(N,{key:1,color:"white","text-color":"primary",icon:"star",label:"Rate Players",onClick:fe})):V("",!0),z.value?(_(),R(N,{key:2,color:"white","text-color":"primary",icon:"close",label:"Close Rating",onClick:da})):V("",!0)])])]),_:1},8,["class"]),t(le,null,{default:o(()=>[P("div",St,"Starting XI ("+k(I.value.starting_count)+"/11)",1),t(Ve,{bordered:"",separator:""},{default:o(()=>[(_(!0),C(ie,null,Se(m.value,(u,D)=>(_(),R(te,{key:D},{default:o(()=>[t(X,{avatar:""},{default:o(()=>[t(Ee,{color:u.player?"primary":"grey","text-color":"white"},{default:o(()=>[M(k(u.number),1)]),_:2},1032,["color"])]),_:2},1024),t(X,null,{default:o(()=>[w.value?(_(),R(oe,{key:0,modelValue:u.player,"onUpdate:modelValue":[L=>u.player=L,L=>ve(D,L)],options:Z(u.role),"option-label":L=>ae(L),label:u.role+" - Select Player",outlined:"",dense:"",clearable:"","emit-value":"","map-options":"",rules:[L=>!!L||"Player is required"]},{option:o(({itemProps:L,opt:U,selected:Q,toggleOption:re})=>[t(te,Ye({ref_for:!0},L,{onClick:ne=>re(U)}),{default:o(()=>[t(X,null,{default:o(()=>[t(K,null,{default:o(()=>[M(k(ae(U)),1)]),_:2},1024),t(K,{caption:""},{default:o(()=>[M(k(U.position),1)]),_:2},1024)]),_:2},1024),t(X,{side:""},{default:o(()=>[t(Ke,{dense:"","model-value":Q},null,8,["model-value"])]),_:2},1024)]),_:2},1040,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","options","option-label","label","rules"])):(_(),C("div",It,[P("div",kt,[t(K,null,{default:o(()=>[M(k(ae(u.player)),1)]),_:2},1024),t(K,{caption:""},{default:o(()=>[M(k(u.role),1)]),_:2},1024)]),P("div",$t,[u.player?(_(),R(Xe,{key:0,"model-value":ge(u.player),size:"1.5em",max:10,icon:"star_border","icon-selected":"star",disable:!z.value||Y.value,"onUpdate:modelValue":L=>{u.player&&(console.log("Rating updated for player:",u.player.id,"value:",L),Qe(u.player.id,L))}},null,8,["model-value","disable","onUpdate:modelValue"])):V("",!0),z.value&&u.player&&ge(u.player)>0?(_(),R(N,{key:1,flat:"",round:"",dense:"",color:"negative",icon:"close",size:"sm",class:"q-ml-sm",onClick:L=>Oe(u.player.id)},null,8,["onClick"])):V("",!0)])]))]),_:2},1024)]),_:2},1024))),128))]),_:1}),P("div",Lt,"Substitutes ("+k(I.value.substitute_count)+"/8)",1),t(Ve,{bordered:"",separator:""},{default:o(()=>[w.value?(_(!0),C(ie,{key:0},Se(i.value,(u,D)=>{var L;return _(),R(te,{key:((L=u.player)==null?void 0:L.id)||D},{default:o(()=>[t(X,{avatar:""},{default:o(()=>[t(Ee,{color:u.player?"grey-6":"grey","text-color":"white"},{default:o(()=>[M(k(u.number),1)]),_:2},1032,["color"])]),_:2},1024),t(X,null,{default:o(()=>[t(oe,{modelValue:u.player,"onUpdate:modelValue":[U=>u.player=U,U=>he(D,U)],options:Z(E(H).Undefined),"option-label":U=>ae(U),label:"Select Substitute",outlined:"",dense:"",clearable:"","emit-value":"","map-options":"",disable:I.value.substitute_count>=8&&!u.player},{option:o(({itemProps:U,opt:Q,selected:re,toggleOption:ne})=>[t(te,Ye({ref_for:!0},U,{onClick:se=>ne(Q)}),{default:o(()=>[t(X,null,{default:o(()=>[t(K,null,{default:o(()=>[M(k(ae(Q)),1)]),_:2},1024),t(K,{caption:""},{default:o(()=>[M(k(Q.position),1)]),_:2},1024)]),_:2},1024),t(X,{side:""},{default:o(()=>[t(Ke,{dense:"","model-value":re},null,8,["model-value"])]),_:2},1024)]),_:2},1040,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","options","option-label","disable"])]),_:2},1024)]),_:2},1024)}),128)):(_(!0),C(ie,{key:1},Se(i.value,(u,D)=>{var L;return _(),R(te,{key:((L=u.player)==null?void 0:L.id)||D},{default:o(()=>[t(X,{avatar:""},{default:o(()=>[t(Ee,{color:"grey-4","text-color":"grey-8"},{default:o(()=>[M(k(u.number),1)]),_:2},1024)]),_:2},1024),t(X,null,{default:o(()=>[P("div",Ft,[P("div",Pt,[t(K,null,{default:o(()=>[M(k(ae(u.player)),1)]),_:2},1024),t(K,{caption:""},{default:o(()=>{var U,Q;return[M(k((Q=(U=u.player)==null?void 0:U.player)==null?void 0:Q.position),1)]}),_:2},1024)]),P("div",Et,[u.player?(_(),R(Xe,{key:0,"model-value":ge(u.player),size:"1.5em",max:10,icon:"star_border","icon-selected":"star",disable:!z.value||Y.value,"onUpdate:modelValue":U=>{u.player&&(console.log("Rating updated for substitute:",u.player.id,"value:",U),Qe(u.player.id,U))}},null,8,["model-value","disable","onUpdate:modelValue"])):V("",!0),z.value&&u.player&&ge(u.player)>0?(_(),R(N,{key:1,flat:"",round:"",dense:"",color:"negative",icon:"close",size:"sm",class:"q-ml-sm",onClick:U=>Oe(u.player.id)},null,8,["onClick"])):V("",!0)])])]),_:2},1024)]),_:2},1024)}),128)),i.value.length===0?(_(),R(te,{key:2},{default:o(()=>[t(X,null,{default:o(()=>[t(K,{class:"text-grey-7"},{default:o(()=>d[2]||(d[2]=[M("No substitutes")])),_:1})]),_:1})]),_:1})):V("",!0)]),_:1}),w.value?(_(),R(ct,{key:0,class:Re([I.value.is_valid?"bg-positive":"bg-warning","text-white q-mt-md"])},{default:o(()=>[M(k(I.value.message),1)]),_:1},8,["class"])):V("",!0),w.value?(_(),C("div",Ct,[P("div",Mt,[t(N,{color:"primary",icon:"add",label:"Add New Player",class:"full-width",onClick:d[1]||(d[1]=u=>r.$emit("add-player-click"))})]),P("div",qt,[t(N,{color:"secondary",icon:"auto_fix_high",label:"Auto-fill Lineup",class:"full-width",onClick:pe})]),P("div",Rt,[t(N,{color:"positive",icon:"save",label:"Save Lineup",disable:!I.value.is_valid,loading:F.value,onClick:Fe,class:"full-width"},null,8,["disable","loading"])]),P("div",Vt,[t(N,{color:"negative",icon:"cancel",label:"Cancel",onClick:Le,class:"full-width"})])])):V("",!0)]),_:1})]),_:1})):V("",!0)])}}}),Ze=ee(At,[["__scopeId","data-v-932f0b89"]]),Dt={class:"match-lineups"},Gt={key:0,class:"flex justify-center q-pa-xl"},Nt={key:1,class:"text-negative q-pa-md"},Bt={key:2,class:"row q-col-gutter-md"},Ut={class:"col-12 col-md-6"},Qt={class:"col-12 col-md-6"},Ot=x({__name:"MatchLineups",props:{match:{},loading:{type:Boolean},error:{}},setup(n){const e=n,a=ra();return ta(async()=>{try{if(e.match.homeTeam&&(!e.match.homeTeam.players||e.match.homeTeam.players.length===0))try{const c=await a.fetchPlayersByTeam(e.match.homeTeam.id);c&&(a.playersByTeam[e.match.homeTeam.id]=c)}catch(c){console.error("Failed to fetch home team players:",c)}if(e.match.awayTeam&&(!e.match.awayTeam.players||e.match.awayTeam.players.length===0))try{const c=await a.fetchPlayersByTeam(e.match.awayTeam.id);c&&(a.playersByTeam[e.match.awayTeam.id]=c)}catch(c){console.error("Failed to fetch away team players:",c)}}catch(c){console.error("Failed to initialize lineups:",c)}}),(c,S)=>{var s,f;return _(),C("div",Dt,[S[0]||(S[0]=P("div",{class:"text-h6 q-mb-md"},"Lineups",-1)),c.loading?(_(),C("div",Gt,[t(la,{color:"primary",size:"3em"})])):c.error?(_(),C("div",Nt,k(c.error),1)):(_(),C("div",Bt,[P("div",Ut,[(s=c.match)!=null&&s.homeTeam?(_(),R(Ze,{key:0,team:c.match.homeTeam,lineup:c.match.homeTeamLineup,loading:c.loading||!c.match.homeTeamLineup,"match-id":c.match.id},null,8,["team","lineup","loading","match-id"])):V("",!0)]),P("div",Qt,[(f=c.match)!=null&&f.awayTeam?(_(),R(Ze,{key:0,team:c.match.awayTeam,lineup:c.match.awayTeamLineup,loading:c.loading||!c.match.awayTeamLineup,"match-id":c.match.id},null,8,["team","lineup","loading","match-id"])):V("",!0)])]))])}}}),Ht=ee(Ot,[["__scopeId","data-v-9baca545"]]),xe=De({name:"QTimelineEntry",props:{heading:Boolean,tag:{type:String,default:"h3"},side:{type:String,default:"right",validator:n=>["left","right"].includes(n)},icon:String,avatar:String,color:String,title:String,subtitle:String,body:String},setup(n,{slots:e}){const a=pa(na,Ce);if(a===Ce)return console.error("QTimelineEntry needs to be child of QTimeline"),Ce;const c=O(()=>`q-timeline__entry q-timeline__entry--${n.side}`+(n.icon!==void 0||n.avatar!==void 0?" q-timeline__entry--icon":"")),S=O(()=>`q-timeline__dot text-${n.color||a.color}`),s=O(()=>a.layout==="comfortable"&&a.side==="left");return()=>{const f=ya(e.default,[]);if(n.body!==void 0&&f.unshift(n.body),n.heading===!0){const i=[j("div"),j("div"),j(n.tag,{class:"q-timeline__heading-title"},f)];return j("div",{class:"q-timeline__heading"},s.value===!0?i.reverse():i)}let v;n.icon!==void 0?v=[j(ea,{class:"row items-center justify-center",name:n.icon})]:n.avatar!==void 0&&(v=[j("img",{class:"q-timeline__dot-img",src:n.avatar})]);const m=[j("div",{class:"q-timeline__subtitle"},[j("span",{},me(e.subtitle,[n.subtitle]))]),j("div",{class:S.value},v),j("div",{class:"q-timeline__content"},[j("h6",{class:"q-timeline__title"},me(e.title,[n.title]))].concat(f))];return j("li",{class:c.value},s.value===!0?m.reverse():m)}}}),jt=De({name:"QTimeline",props:{...sa,color:{type:String,default:"primary"},side:{type:String,default:"right",validator:n=>["left","right"].includes(n)},layout:{type:String,default:"dense",validator:n=>["dense","comfortable","loose"].includes(n)}},setup(n,{slots:e}){const a=aa(),c=ia(n,a.proxy.$q);va(na,n);const S=O(()=>`q-timeline q-timeline--${n.layout} q-timeline--${n.layout}--${n.side}`+(c.value===!0?" q-timeline--dark":""));return()=>j("ul",{class:S.value},me(e.default))}}),zt={class:"match-info"},Yt={class:"text-h6"},Kt={class:"row q-col-gutter-md"},Xt={class:"col-12 col-md-6"},Jt={class:"col-12 col-md-6"},Wt={class:"text-subtitle2 q-mb-sm"},Zt={key:0},xt=x({__name:"MatchInfo",props:{match:{}},setup(n){const{t:e}=Be(),a=s=>{if(!s)return"N/A";try{const f=new Date(s);return f.setHours(f.getHours()+1),f.toLocaleString("nb-NO",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}).replace("kl.","").replace(", ",`
`).trim()}catch{return s}},c=s=>{switch(s){case T.Goal:return"⚽ "+e("matches.events.goal");case T.YellowCard:return"🟨 "+e("matches.events.yellowCard");case T.RedCard:return"🟥 "+e("matches.events.redCard");case T.Substitution:return"🔄 "+e("matches.events.substitution");case T.HalfTimeStart:return"⏱️ "+e("matches.events.halftime");case T.GameEnd:return"🏁 "+e("matches.events.fullTime");default:return s}},S=s=>{var i;const f=s.player?`${s.player.firstName} ${s.player.lastName}`:e("common.unknown"),v=s.secondaryPlayer?`${s.secondaryPlayer.firstName} ${s.secondaryPlayer.lastName}`:"",m=((i=s.team)==null?void 0:i.name)||"";switch(s.type){case T.Goal:return e("matches.events.goalBy",{player:f,team:m,assist:v?e("matches.events.assistBy",{player:v}):""});case T.YellowCard:case T.RedCard:return e(s.type===T.YellowCard?"matches.events.yellowCardTo":"matches.events.redCardTo",{player:f,team:m});case T.Substitution:return e("matches.events.substitutionEvent",{playerOut:f,playerIn:v,team:m});case T.HalfTimeStart:return e("matches.events.halftime");case T.GameEnd:return e("matches.events.fullTime");default:return s.description||e("matches.events.event")}};return(s,f)=>(_(),C("div",zt,[t(de,{flat:"",bordered:""},{default:o(()=>[t(le,null,{default:o(()=>[P("div",Yt,k(s.$t("matches.information")),1)]),_:1}),t(Ne),t(le,null,{default:o(()=>[P("div",Kt,[P("div",Xt,[t(Ve,null,{default:o(()=>[t(te,null,{default:o(()=>[t(X,null,{default:o(()=>[t(K,{caption:""},{default:o(()=>[M(k(s.$t("match.date")),1)]),_:1}),t(K,null,{default:o(()=>[M(k(a(s.match.scheduledDate)),1)]),_:1})]),_:1})]),_:1}),t(te,null,{default:o(()=>[t(X,null,{default:o(()=>[t(K,{caption:""},{default:o(()=>[M(k(s.$t("match.status.title")),1)]),_:1}),t(K,null,{default:o(()=>[M(k(s.$t(`matches.status.${s.match.status.toLowerCase()}`)),1)]),_:1})]),_:1})]),_:1}),t(te,null,{default:o(()=>[t(X,null,{default:o(()=>[t(K,{caption:""},{default:o(()=>[M(k(s.$t("match.score")),1)]),_:1}),t(K,null,{default:o(()=>{var v,m,i,w;return[M(k((v=s.match.homeTeam)==null?void 0:v.name)+" "+k((m=s.match.score)==null?void 0:m.homeTeamScore)+" - "+k((i=s.match.score)==null?void 0:i.awayTeamScore)+" "+k((w=s.match.awayTeam)==null?void 0:w.name),1)]}),_:1})]),_:1})]),_:1})]),_:1})]),P("div",Jt,[P("div",Wt,k(s.$t("matches.events.title")),1),t(jt,{color:"primary"},{default:o(()=>[(_(!0),C(ie,null,Se(s.match.events||[],v=>(_(),R(xe,{key:v.id,title:S(v),subtitle:`${v.minuteOfMatch}' - ${c(v.type)}`,icon:"sports_soccer"},{default:o(()=>[v.description?(_(),C("div",Zt,k(v.description),1)):V("",!0)]),_:2},1032,["title","subtitle"]))),128)),!s.match.events||s.match.events.length===0?(_(),R(xe,{key:0,title:s.$t("matches.events.noEvents"),icon:"sports_soccer"},{default:o(()=>[P("div",null,k(s.$t("matches.events.noEventsDescription")),1)]),_:1},8,["title"])):V("",!0)]),_:1})])])]),_:1})]),_:1})]))}}),el=ee(xt,[["__scopeId","data-v-8cb258d8"]]),al={class:"match-detail"},tl={key:0,class:"flex justify-center q-pa-xl"},ll={key:1,class:"text-negative q-pa-md"},nl={key:2,class:"match-content"},ol={key:0,class:"row justify-end q-mb-md"},rl=x({__name:"MatchDetailPage",setup(n){const e=ha(),a=Ae(),c=O(()=>a.isAuthenticated),S=G(!1),s=G(T.Goal),{match:f,loading:v,error:m,refetch:i}=ue.useMatch(e.params.id),w=async p=>{try{const{updateMatch:g}=ue.useUpdateMatch();await g(p)}catch(g){console.error("Error updating match:",g)}},b=async()=>{S.value=!1,await i()};return(p,g)=>{var F,Y;return _(),C("div",al,[E(v)?(_(),C("div",tl,[t(la,{color:"primary",size:"3em"})])):E(m)?(_(),C("div",ll,k(E(m).message),1)):(_(),C("div",nl,[t(et,{match:E(f),loading:E(v),error:(F=E(m))==null?void 0:F.message,"onUpdate:match":w},null,8,["match","loading","error"]),fa(t(dt,{match:E(f),"onUpdate:match":w},null,8,["match"]),[[ga,E(a).isAuthenticated]]),t(Ht,{match:E(f),loading:E(v),error:(Y=E(m))==null?void 0:Y.message,"onUpdate:match":w},null,8,["match","loading","error"]),t(el,{match:E(f)},null,8,["match"]),c.value?(_(),C("div",ol,[t(N,{color:"primary",icon:"add",label:"Add Event",onClick:g[0]||(g[0]=z=>S.value=!0)})])):V("",!0),t(oa,{modelValue:S.value,"onUpdate:modelValue":g[2]||(g[2]=z=>S.value=z),persistent:""},{default:o(()=>[t(de,{style:{"min-width":"500px"}},{default:o(()=>[t(ua,{match:E(f),"event-type":s.value,onEventAdded:b,onCancel:g[1]||(g[1]=z=>S.value=!1)},null,8,["match","event-type"])]),_:1})]),_:1},8,["modelValue"])]))])}}}),Pl=ee(rl,[["__scopeId","data-v-31eb02c0"]]);export{Pl as default};
