import{d as Z,R as G,S as b,U as n,ab as ca,r as N,V as C,$ as P,Z as D,f as a,W as V,X as E,Y as $,q as B,c as j,Q as We,ac as Ve,N as Ze,F as ce,l as Fe,ad as pa,ae as ya,h as O,m as pe,g as ea,af as $e,w as Ee,o as aa,a4 as Le,a2 as Ce,ag as xe,ah as va,ai as Oe,a1 as ta,L as fa,a as ha,u as qe,aj as la,y as ga,ak as ba,a3 as _a}from"./index-B0VQveaP.js";import{Q as ie,a as ae}from"./QCard-CVGY935i.js";import{a as re,b as Re,c as je}from"./QCheckbox-CwaufW_b.js";import{m as ye,u as Pe,A as wa,a as Ta,L as Ge,D as Sa,S as Ia}from"./matchService-CZ6UWKyM.js";import{S as Q,E as T,F as k,P as z}from"./graphql-BhlZu-4f.js";import{h as De}from"./use-prevent-scroll-D4LJUV1U.js";import{Q as W}from"./QTooltip-CFuJyv8v.js";import{Q as ka}from"./QBadge-DEZCwRhf.js";import{_ as ee,g as Ue}from"./_plugin-vue_export-helper-C58nmRBO.js";import{T as La}from"./TeamLogo-DZofpy_h.js";import{Q as na,a as me}from"./QForm-CUODXvPM.js";import{g as Ae,u as oa}from"./players-D7Cl8eS4.js";import{C as $a}from"./ClosePopup-C2uit85j.js";import{Q as Me,a as oe,b as K,c as J}from"./QList-zKzsZTH7.js";import{Q as ze}from"./QRating-BO_aCy3d.js";import{u as ra,a as sa}from"./use-dark-lD2g5drB.js";import{u as ia}from"./use-quasar-DNOobXI3.js";import"./format-JhNblhKf.js";import"./private.use-form-C0ppHoVJ.js";import"./scroll-arY7zoUF.js";import"./teamService-COePzt3j.js";const Pa=Z({__name:"MatchBadge",props:{color:{}},setup(o){return(h,e)=>(b(),G(ka,{color:h.color,class:"match-badge"},{default:n(()=>[ca(h.$slots,"default",{},void 0,!0)]),_:3},8,["color"]))}}),Ye=ee(Pa,[["__scopeId","data-v-a6da57b4"]]),Fa={class:"row items-center justify-between"},Ea={class:"col-auto"},Ca={key:0,class:"col-auto"},qa={key:1,class:"row items-center q-gutter-sm"},Aa=Z({__name:"MatchHeader",props:{status:{},isAdmin:{type:Boolean},editable:{type:Boolean}},emits:["update:status"],setup(o,{emit:h}){const e=u=>{switch(u){case Q.Scheduled:return"Scheduled";case Q.InProgress:return"Live";case Q.Completed:return"Finished";case Q.Postponed:return"Postponed";case Q.Cancelled:return"Cancelled";default:return"Unknown"}},S=u=>{switch(u){case Q.Scheduled:return"blue";case Q.InProgress:return"red";case Q.Completed:return"green";case Q.Postponed:return"orange";case Q.Cancelled:return"grey";default:return"grey"}},r=o,m=h,c=N(!1),v=N(r.status),p=Object.values(Q).map(u=>({label:e(u),value:u})),l=()=>{r.editable&&(c.value=!0,v.value=r.status)},w=()=>{m("update:status",v.value),c.value=!1},g=()=>{v.value=r.status,c.value=!1},f=u=>{v.value=u};return(u,F)=>(b(),C("div",Fa,[P("div",Ea,[a(Ye,{color:S(u.status)},{default:n(()=>[V(E(e(u.status)),1)]),_:1},8,["color"]),u.status===$(Q).InProgress?(b(),G(Ye,{key:0,color:"red",class:"q-ml-xs"},{default:n(()=>F[1]||(F[1]=[V(" LIVE ")])),_:1})):D("",!0)]),u.isAdmin&&u.editable?(b(),C("div",Ca,[c.value?(b(),C("div",qa,[a(re,{modelValue:v.value,"onUpdate:modelValue":[F[0]||(F[0]=Y=>v.value=Y),f],options:$(p),dense:"",outlined:"",class:"col-auto"},null,8,["modelValue","options"]),a(B,{flat:"",round:"",color:"positive",icon:"check",onClick:w},{default:n(()=>[a(W,null,{default:n(()=>F[3]||(F[3]=[V("Save changes")])),_:1})]),_:1}),a(B,{flat:"",round:"",color:"negative",icon:"close",onClick:g},{default:n(()=>[a(W,null,{default:n(()=>F[4]||(F[4]=[V("Cancel")])),_:1})]),_:1})])):(b(),G(B,{key:0,flat:"",round:"",color:"primary",icon:"edit",onClick:l},{default:n(()=>[a(W,null,{default:n(()=>F[2]||(F[2]=[V("Edit match details")])),_:1})]),_:1}))])):D("",!0)]))}}),Va=ee(Aa,[["__scopeId","data-v-a201e29e"]]),Ma={class:"team-display text-center"},Ra={class:"text-h6 text-weight-bold"},Ga=Z({__name:"TeamDisplay",props:{team:{},logoSize:{default:"80px"},buttonLabel:{default:"View Team"}},setup(o){return(h,e)=>{var S,r;return b(),C("div",Ma,[a(La,{"team-id":(S=h.team)==null?void 0:S.id,size:h.logoSize||"80px",class:"q-mb-sm"},null,8,["team-id","size"]),P("div",Ra,E((r=h.team)==null?void 0:r.name),1),h.team?(b(),G(B,{key:0,flat:"","no-caps":"",color:"primary",to:`/teams/${h.team.id}`,label:h.buttonLabel,class:"q-mt-sm"},null,8,["to","label"])):D("",!0)])}}}),Je=ee(Ga,[["__scopeId","data-v-cca40ce4"]]),Da={class:"match-score text-center"},Ua={key:0,class:"text-h3 text-weight-bold"},Na={key:1,class:"text-h3 text-weight-bold text-grey"},Ba={class:"text-subtitle1 q-mt-sm"},Qa={key:2,class:"text-caption"},Ha=Z({__name:"MatchScore",props:{homeScore:{},awayScore:{},status:{},formattedDate:{},stadium:{}},setup(o){const h=o,e=j(()=>h.status===Q.InProgress||h.status===Q.Completed);return(S,r)=>(b(),C("div",Da,[e.value?(b(),C("div",Ua,E(S.homeScore)+" - "+E(S.awayScore),1)):(b(),C("div",Na," vs ")),P("div",Ba,E(S.formattedDate),1),S.stadium?(b(),C("div",Qa,E(S.stadium),1)):D("",!0)]))}}),xa=ee(Ha,[["__scopeId","data-v-6d0d635a"]]),Oa={class:"dice-rating"},ja=Z({__name:"DiceRating",props:{modelValue:{},editable:{type:Boolean}},emits:["update:modelValue"],setup(o,{emit:h}){const e=o,S=h,r=j({get:()=>e.modelValue,set:v=>S("update:modelValue",v)}),m=j(()=>r.value?"primary":"grey"),c=()=>{e.editable&&(r.value&&r.value<6?r.value++:r.value=1)};return(v,p)=>(b(),C("div",Oa,[a(We,{name:"casino",color:m.value,size:"24px",class:Ve({"cursor-pointer":v.editable}),onClick:c},{default:n(()=>[a(W,null,{default:n(()=>[V(E(r.value||"Click to rate"),1)]),_:1})]),_:1},8,["color","class"])]))}}),za=ee(ja,[["__scopeId","data-v-cd86a821"]]),Ya={class:"match-detail-header"},Ja={class:"row items-center q-col-gutter-lg"},Xa={class:"col-xs-12 col-sm-5"},Ka={class:"col-xs-12 col-sm-2"},Wa={class:"row justify-center q-mt-sm"},Za={class:"col-xs-12 col-sm-5"},et=Z({__name:"MatchDetailHeader",props:{match:{},editable:{type:Boolean}},emits:["update:match"],setup(o,{emit:h}){const e=o,S=Ze(),r=j(()=>S.isAuthenticated),m=h,c=l=>{m("update:match",{...e.match,rating:l})},v=l=>{m("update:match",{...e.match,status:l})},p=l=>{if(!l)return"N/A";try{const w=new Date(l);return w.setHours(w.getHours()+1),w.toLocaleString("nb-NO",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}).replace("kl.","").replace(", ",`
`).trim()}catch{return l}};return(l,w)=>(b(),C("div",Ya,[a(ie,{flat:"",bordered:""},{default:n(()=>[a(ae,null,{default:n(()=>[a(Va,{status:l.match.status,"is-admin":r.value,editable:l.editable,"onUpdate:status":v},null,8,["status","is-admin","editable"])]),_:1}),a(De),a(ae,null,{default:n(()=>{var g,f;return[P("div",Ja,[P("div",Xa,[a(Je,{team:l.match.homeTeam},null,8,["team"])]),P("div",Ka,[a(xa,{"home-score":(g=l.match.score)==null?void 0:g.homeTeamScore,"away-score":(f=l.match.score)==null?void 0:f.awayTeamScore,status:l.match.status,"formatted-date":p(l.match.scheduledDate)},null,8,["home-score","away-score","status","formatted-date"]),P("div",Wa,[a(za,{"model-value":l.match.rating,editable:l.editable,"onUpdate:modelValue":c},null,8,["model-value","editable"])])]),P("div",Za,[a(Je,{team:l.match.awayTeam},null,8,["team"])])])]}),_:1})]),_:1})]))}}),at=ee(et,[["__scopeId","data-v-e2d4f35c"]]),tt={class:"match-event-form"},lt={class:"text-h6"},nt={class:"row q-col-gutter-md"},ot={class:"col-6"},rt={class:"col-6"},st={class:"row justify-end q-gutter-sm"},it=Z({__name:"MatchEventForm",props:{match:{},eventType:{}},emits:["event-added","cancel"],setup(o,{emit:h}){const e=o,S=h,r=N(null),m=N(null),c=N(null),v=N(null),p=N(null),l=N(null),w=N(null),g=N(null),f=N(!1);e.match.score&&(w.value=e.match.score.homeTeamScore,g.value=e.match.score.awayTeamScore);const u=j(()=>{switch(e.eventType){case T.Goal:return"Add Goal";case T.OwnGoal:return"Add Own Goal";case T.YellowCard:return"Add Yellow Card";case T.RedCard:return"Add Red Card";case T.Substitution:return"Add Substitution";case T.HalfTimeStart:return"Add Halftime";case T.GameEnd:return"End Game";default:return"Add Event"}}),F=M=>{const i=M===e.match.homeTeamId?e.match.homeTeamLineup:e.match.awayTeamLineup;return(i==null?void 0:i.players.map(R=>R.player).filter(R=>R!==null))||[]},Y=M=>{const X=(e.eventType===T.OwnGoal?M===e.match.homeTeamId?e.match.awayTeamId:e.match.homeTeamId:M)===e.match.homeTeamId?e.match.homeTeamLineup:e.match.awayTeamLineup;return(X==null?void 0:X.players.map(I=>I.player).filter(I=>I!==null))||[]},le=j(()=>{switch(e.eventType){case T.Goal:case T.OwnGoal:return"Goalscorer";case T.Substitution:return"Substitute Out";case T.YellowCard:case T.RedCard:return"Player";default:return"Player"}}),fe=async()=>{var M,i,R,X,I,q,be;if(e.eventType===T.GameEnd){if(!l.value||w.value===null||g.value===null)return}else if(e.eventType===T.HalfTimeStart){if(!l.value)return}else if(!r.value||!m.value||!c.value)return;f.value=!0;try{const{addMatchEvent:he}=ye.useAddMatchEvent();if(e.eventType===T.Goal||e.eventType===T.OwnGoal){const ve=((M=m.value)==null?void 0:M.id)===e.match.homeTeamId,_e=((i=e.match.score)==null?void 0:i.homeTeamScore)||0,ne=((R=e.match.score)==null?void 0:R.awayTeamScore)||0;e.eventType===T.Goal?ve?w.value=_e+1:g.value=ne+1:ve?g.value=ne+1:w.value=_e+1}if(await he({matchId:e.match.id,type:e.eventType,minuteOfMatch:e.eventType===T.HalfTimeStart?45:r.value,playerId:e.eventType===T.HalfTimeStart||(X=c.value)==null?void 0:X.id,teamId:e.eventType===T.HalfTimeStart||(I=m.value)==null?void 0:I.id,secondaryPlayerId:e.eventType===T.Substitution?(q=p.value)==null?void 0:q.id:e.eventType===T.Goal||e.eventType===T.OwnGoal?(be=v.value)==null?void 0:be.id:void 0,description:e.eventType===T.HalfTimeStart||e.eventType===T.GameEnd?`Added minutes: ${l.value}`:void 0,timestamp:new Date().toISOString()}),e.eventType===T.Goal||e.eventType===T.OwnGoal||e.eventType===T.GameEnd){const{updateMatchScore:ve}=ye.useUpdateMatchScore();await ve(e.match.id,{homeTeamScore:w.value,awayTeamScore:g.value})}S("event-added")}catch(he){console.error("Error adding match event:",he)}finally{f.value=!1}};return(M,i)=>(b(),C("div",tt,[a(ie,{flat:"",bordered:""},{default:n(()=>[a(ae,null,{default:n(()=>[P("div",lt,E(u.value),1)]),_:1}),a(De),a(ae,null,{default:n(()=>[a(na,{onSubmit:fe,class:"q-gutter-md"},{default:n(()=>{var R,X;return[M.eventType!==$(T).HalfTimeStart?(b(),G(me,{key:0,modelValue:r.value,"onUpdate:modelValue":i[0]||(i[0]=I=>r.value=I),modelModifiers:{number:!0},type:"number",label:"Minute",rules:[I=>!!I||"Minute is required",I=>I>=0||"Minute must be positive",I=>I<=120||"Minute must be less than 120"],outlined:""},null,8,["modelValue","rules"])):D("",!0),M.eventType!==$(T).HalfTimeStart&&M.eventType!==$(T).GameEnd?(b(),G(re,{key:1,modelValue:m.value,"onUpdate:modelValue":i[1]||(i[1]=I=>m.value=I),options:[M.match.homeTeam,M.match.awayTeam],"option-label":"name",label:"Team",rules:[I=>!!I||"Team is required"],outlined:""},null,8,["modelValue","options","rules"])):D("",!0),m.value&&M.eventType!==$(T).HalfTimeStart&&M.eventType!==$(T).GameEnd?(b(),G(re,{key:2,modelValue:c.value,"onUpdate:modelValue":i[2]||(i[2]=I=>c.value=I),options:F(m.value.id),"option-label":$(Ae),label:le.value,rules:[I=>!!I||"Player is required"],outlined:""},null,8,["modelValue","options","option-label","label","rules"])):D("",!0),m.value&&(M.eventType===$(T).Goal||M.eventType===$(T).OwnGoal)?(b(),G(re,{key:3,modelValue:v.value,"onUpdate:modelValue":i[3]||(i[3]=I=>v.value=I),options:Y(m.value.id),"option-label":$(Ae),label:"Assist (optional)",outlined:""},null,8,["modelValue","options","option-label"])):D("",!0),M.eventType===$(T).Substitution&&m.value?(b(),G(re,{key:4,modelValue:p.value,"onUpdate:modelValue":i[4]||(i[4]=I=>p.value=I),options:F(m.value.id),"option-label":$(Ae),label:"Substitute In",rules:[I=>!!I||"Substitute player is required"],outlined:""},null,8,["modelValue","options","option-label","rules"])):D("",!0),M.eventType===$(T).HalfTimeStart||M.eventType===$(T).GameEnd?(b(),G(me,{key:5,modelValue:l.value,"onUpdate:modelValue":i[5]||(i[5]=I=>l.value=I),modelModifiers:{number:!0},type:"number",label:"Added Minutes",rules:[I=>!!I||"Added minutes is required",I=>I>=0||"Added minutes must be positive",I=>I<=99||"Added minutes must be less than 100"],outlined:""},null,8,["modelValue","rules"])):D("",!0),M.eventType===$(T).GameEnd?(b(),C(ce,{key:6},[i[9]||(i[9]=P("div",{class:"text-subtitle1 q-mt-md"},"Final Score",-1)),P("div",nt,[P("div",ot,[a(me,{modelValue:w.value,"onUpdate:modelValue":i[6]||(i[6]=I=>w.value=I),modelModifiers:{number:!0},type:"number",label:(R=M.match.homeTeam)==null?void 0:R.name,rules:[I=>!!I||"Score is required",I=>I>=0||"Score must be positive"],outlined:""},null,8,["modelValue","label","rules"])]),P("div",rt,[a(me,{modelValue:g.value,"onUpdate:modelValue":i[7]||(i[7]=I=>g.value=I),modelModifiers:{number:!0},type:"number",label:(X=M.match.awayTeam)==null?void 0:X.name,rules:[I=>!!I||"Score is required",I=>I>=0||"Score must be positive"],outlined:""},null,8,["modelValue","label","rules"])])])],64)):D("",!0),P("div",st,[a(B,{label:"Cancel",color:"negative",onClick:i[8]||(i[8]=I=>M.$emit("cancel"))}),a(B,{label:"Add Event",type:"submit",color:"primary",loading:f.value},null,8,["loading"])])]}),_:1})]),_:1})]),_:1})]))}}),ua=ee(it,[["__scopeId","data-v-dbe48d02"]]),ut={class:"match-event-bar"},dt=Z({__name:"MatchEventBar",props:{match:{}},emits:["update:match"],setup(o,{emit:h}){const e=o,S=h,r=N(!1),m=N(null),c=j(()=>{var f;return(f=e.match.events)==null?void 0:f.some(u=>u.type===T.HalfTimeStart)}),v=f=>{m.value=f,r.value=!0},p=async()=>{try{const{updateMatchStatus:f}=ye.useUpdateMatchStatus();await f(e.match.id,Q.InProgress),S("update:match",{...e.match,status:Q.InProgress})}catch(f){console.error("Error starting match:",f)}},l=async()=>{try{const{updateMatchStatus:f}=ye.useUpdateMatchStatus();await f(e.match.id,Q.InProgress),S("update:match",{...e.match,status:Q.InProgress})}catch(f){console.error("Error resuming match:",f)}},w=()=>{m.value=T.GameEnd,r.value=!0},g=async()=>{r.value=!1,m.value=null;try{const{updateMatchStatus:f}=ye.useUpdateMatchStatus();await f(e.match.id,Q.Completed),S("update:match",{...e.match,status:Q.Completed})}catch(f){console.error("Error ending match:",f)}};return(f,u)=>(b(),C("div",ut,[a(ie,{flat:"",bordered:""},{default:n(()=>[a(ae,{class:"row items-center justify-center q-gutter-md"},{default:n(()=>[f.match.status===$(Q).Scheduled?(b(),G(B,{key:0,flat:"",round:"",color:"primary",icon:"play_arrow",onClick:p},{default:n(()=>[a(W,null,{default:n(()=>u[8]||(u[8]=[V("Start Match")])),_:1})]),_:1})):f.match.status===$(Q).InProgress?(b(),C(ce,{key:1},[c.value?(b(),G(B,{key:1,flat:"",round:"",color:"primary",icon:"play_arrow",onClick:l},{default:n(()=>[a(W,null,{default:n(()=>u[15]||(u[15]=[V("Resume Match")])),_:1})]),_:1})):(b(),C(ce,{key:0},[a(B,{flat:"",round:"",color:"positive",icon:"sports_soccer",onClick:u[0]||(u[0]=F=>v($(T).Goal))},{default:n(()=>[a(W,null,{default:n(()=>u[9]||(u[9]=[V("Add Goal")])),_:1})]),_:1}),a(B,{flat:"",round:"",color:"negative",icon:"sports_soccer",onClick:u[1]||(u[1]=F=>v($(T).OwnGoal))},{default:n(()=>[a(W,null,{default:n(()=>u[10]||(u[10]=[V("Add Own Goal")])),_:1})]),_:1}),a(B,{flat:"",round:"",color:"warning",icon:"square",onClick:u[2]||(u[2]=F=>v($(T).YellowCard))},{default:n(()=>[a(W,null,{default:n(()=>u[11]||(u[11]=[V("Add Yellow Card")])),_:1})]),_:1}),a(B,{flat:"",round:"",color:"negative",icon:"square",onClick:u[3]||(u[3]=F=>v($(T).RedCard))},{default:n(()=>[a(W,null,{default:n(()=>u[12]||(u[12]=[V("Add Red Card")])),_:1})]),_:1}),a(B,{flat:"",round:"",color:"info",icon:"swap_vert",onClick:u[4]||(u[4]=F=>v($(T).Substitution))},{default:n(()=>[a(W,null,{default:n(()=>u[13]||(u[13]=[V("Add Substitution")])),_:1})]),_:1}),a(B,{flat:"",round:"",color:"grey",icon:"timer",onClick:u[5]||(u[5]=F=>v($(T).HalfTimeStart))},{default:n(()=>[a(W,null,{default:n(()=>u[14]||(u[14]=[V("Add Halftime")])),_:1})]),_:1})],64)),a(B,{flat:"",round:"",color:"negative",icon:"stop",onClick:w},{default:n(()=>[a(W,null,{default:n(()=>u[16]||(u[16]=[V("End Match")])),_:1})]),_:1})],64)):D("",!0)]),_:1})]),_:1}),a(Re,{modelValue:r.value,"onUpdate:modelValue":u[7]||(u[7]=F=>r.value=F),persistent:""},{default:n(()=>[a(ie,{style:{"min-width":"500px"}},{default:n(()=>[a(ua,{match:f.match,"event-type":m.value,onEventAdded:g,onCancel:u[6]||(u[6]=F=>r.value=!1)},null,8,["match","event-type"])]),_:1})]),_:1},8,["modelValue"])]))}}),mt=ee(dt,[["__scopeId","data-v-41c79917"]]),ct=Fe({name:"QCardActions",props:{...pa,vertical:Boolean},setup(o,{slots:h}){const e=ya(o),S=j(()=>`q-card__actions ${e.value} q-card__actions--${o.vertical===!0?"vert column":"horiz row"}`);return()=>O("div",{class:S.value},pe(h.default))}}),pt=Fe({name:"QBanner",props:{...ra,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(o,{slots:h}){const{proxy:{$q:e}}=ea(),S=sa(o,e),r=j(()=>"q-banner row items-center"+(o.dense===!0?" q-banner--dense":"")+(S.value===!0?" q-banner--dark q-dark":"")+(o.rounded===!0?" rounded-borders":"")),m=j(()=>`q-banner__actions row items-center justify-end col-${o.inlineActions===!0?"auto":"all"}`);return()=>{const c=[O("div",{class:"q-banner__avatar col-auto row items-center self-start"},pe(h.avatar)),O("div",{class:"q-banner__content col text-body2"},pe(h.default))],v=pe(h.action);return v!==void 0&&c.push(O("div",{class:m.value},v)),O("div",{class:r.value+(o.inlineActions===!1&&v!==void 0?" q-banner--top-padding":""),role:"alert"},c)}}}),te={isRating:N(!1),async startRatingMode(o){console.log("Starting rating mode"),this.isRating.value=!0;const h=o.filter(e=>e.playerId?parseInt(e.position)<=11:!1);await Promise.all(h.map(async e=>{try{console.log("Setting default rating for starting player:",e.playerId),await this.savePlayerRating(e.playerId,5)}catch(S){console.error("Error setting default rating for player:",e.playerId,S)}}))},stopRatingMode(){console.log("Stopping rating mode"),this.isRating.value=!1},async savePlayerRating(o,h){try{console.log("Saving rating for player:",o,"rating:",h),await this.useAddSimpleRating().addSimpleRating(o,h)}catch(e){throw console.error("Error updating player rating:",e),e}},async updatePlayerRating(o,h){console.log("Updating rating for player:",o,"rating:",h),await this.savePlayerRating(o,h)},async removePlayerRating(o){console.log("Removing rating for player:",o),await this.savePlayerRating(o,0)},getPlayerRating(o,h){const e=h.find(S=>S.playerId===o);return e?e.ratings[e.ratings.length-1].score:0},useAddRating(){const{mutate:o,loading:h,error:e}=$e(Ta),S=Pe();return{addRating:async m=>{var c,v;try{console.log("Adding rating with input:",m);const p=await o({input:m});if(console.log("Rating result:",p),(c=p==null?void 0:p.data)!=null&&c.addRating){const l=S.matches.findIndex(w=>{var g,f;return((g=w.homeTeamLineup)==null?void 0:g.players.some(u=>u.id===m.matchPlayerId))||((f=w.awayTeamLineup)==null?void 0:f.players.some(u=>u.id===m.matchPlayerId))});if(l!==-1){const w=S.matches[l];if(w.homeTeamLineup){const g=w.homeTeamLineup.players.findIndex(f=>f.id===m.matchPlayerId);g!==-1&&(w.homeTeamLineup.players[g].ratings||(w.homeTeamLineup.players[g].ratings=[]),w.homeTeamLineup.players[g].ratings.push(p.data.addRating))}if(w.awayTeamLineup){const g=w.awayTeamLineup.players.findIndex(f=>f.id===m.matchPlayerId);g!==-1&&(w.awayTeamLineup.players[g].ratings||(w.awayTeamLineup.players[g].ratings=[]),w.awayTeamLineup.players[g].ratings.push(p.data.addRating))}}}return(v=p==null?void 0:p.data)==null?void 0:v.addRating}catch(p){throw console.error("Error adding rating:",p),p}},loading:h,error:e}},useAddSimpleRating(){const{mutate:o,loading:h,error:e}=$e(wa),S=Pe();return{addSimpleRating:async(m,c)=>{var v,p;try{const l=await o({matchPlayerId:m,score:c});if((v=l==null?void 0:l.data)!=null&&v.addSimpleRating){const w=S.matches.findIndex(g=>{var f,u;return((f=g.homeTeamLineup)==null?void 0:f.players.some(F=>F.id===m))||((u=g.awayTeamLineup)==null?void 0:u.players.some(F=>F.id===m))});if(w!==-1){const g=S.matches[w];if(g.homeTeamLineup){const f=g.homeTeamLineup.players.findIndex(u=>u.id===m);f!==-1&&(g.homeTeamLineup.players[f].ratings||(g.homeTeamLineup.players[f].ratings=[]),g.homeTeamLineup.players[f].ratings.push(l.data.addSimpleRating))}if(g.awayTeamLineup){const f=g.awayTeamLineup.players.findIndex(u=>u.id===m);f!==-1&&(g.awayTeamLineup.players[f].ratings||(g.awayTeamLineup.players[f].ratings=[]),g.awayTeamLineup.players[f].ratings.push(l.data.addSimpleRating))}}}return(p=l==null?void 0:l.data)==null?void 0:p.addSimpleRating}catch(l){throw console.error("Error adding simple rating:",l),l}},loading:h,error:e}},getRatingColor(o){return o>=9||o>=8||o>=7?"positive":o>=6||o>=5?"warning":(o>=4||o>=3,"negative")}},yt={class:"lineup"},vt={key:0,class:"text-caption q-mb-sm"},ft={key:1,class:"row q-col-gutter-md"},ht={class:"col-12"},gt={class:"row items-center justify-between"},bt={class:"text-h6"},_t={class:"text-subtitle2"},wt={class:"row q-gutter-sm"},Tt={class:"text-subtitle2 q-mb-sm"},St={key:1,class:"row items-center justify-between"},It={class:"col"},kt={class:"row items-center"},Lt={class:"text-subtitle2 q-mt-md q-mb-sm"},$t={class:"row items-center justify-between"},Pt={class:"col"},Ft={class:"row items-center"},Et={key:1,class:"row q-col-gutter-md q-mt-md"},Ct={class:"col-6"},qt={class:"col-6"},At={class:"col-12"},Vt={class:"col-12"},Mt=Z({__name:"LineupCard",props:{team:{},loading:{type:Boolean},lineup:{}},emits:["update:lineup","save","add-player-click","update:team"],setup(o,{emit:h}){var He;const e=o,S=h,r=oa(),m=r.playersByTeam[e.team.id]||[],c=[{label:"Custom",value:k.FormationCustom},{label:"4-4-2",value:k.Formation442},{label:"4-3-3",value:k.Formation433},{label:"3-5-2",value:k.Formation352},{label:"3-4-3",value:k.Formation343},{label:"4-2-3-1",value:k.Formation4231},{label:"4-3-2-1",value:k.Formation4321},{label:"5-3-2",value:k.Formation532},{label:"5-4-1",value:k.Formation541},{label:"4-5-1",value:k.Formation451},{label:"5-2-3",value:k.Formation523},{label:"4-1-4-1",value:k.Formation4141},{label:"3-1-4-2",value:k.Formation3142}],v=N(k.Formation442);(He=e.lineup)!=null&&He.formation&&(v.value=e.lineup.formation);const p=N([]),l=N([]),w=N(!1),g=N(null),f=N(k.Formation442),u=ia(),F=N(!1),Y=N(!1),le=()=>{g.value=e.lineup?{...e.lineup}:null,f.value=v.value,w.value=!0},fe=()=>{g.value&&(v.value=f.value,M()),w.value=!1},M=()=>{if(e.lineup){p.value.forEach(d=>d.player=null),l.value.forEach(d=>d.player=null);for(const d of e.lineup.players){if(!d.player){console.warn("Skipping match player with no player data:",d);continue}const s=parseInt(d.position);if(isNaN(s)){console.warn("Invalid position number:",d.position);continue}if(s<=11){const _=p.value.find(y=>y.number===s);_?_.player=d:console.warn(`Could not find position ${s} in starting positions. Available positions:`,p.value.map(y=>y.number))}else{const _=l.value.find(y=>y.number===s);_?_.player=d:console.warn(`Could not find substitute position ${s}. Available substitute positions:`,l.value.map(y=>y.number))}}}},i=()=>{p.value=Array.from({length:11},(t,A)=>({number:A+1,role:z.Goalkeeper,player:null}));const d=v.value;let s=4,_=4,y=2;switch(d){case k.FormationCustom:break;case k.Formation442:s=4,_=4,y=2;break;case k.Formation433:s=4,_=3,y=3;break;case k.Formation352:s=3,_=5,y=2;break;case k.Formation343:s=3,_=4,y=3;break;case k.Formation4231:s=4,_=2,y=3;break;case k.Formation4321:s=4,_=3,y=2;break;case k.Formation532:s=5,_=3,y=2;break;case k.Formation541:s=5,_=4,y=1;break;case k.Formation451:s=4,_=5,y=1;break;case k.Formation523:s=5,_=2,y=3;break;case k.Formation4141:s=4,_=1,y=4;break;case k.Formation3142:s=3,_=1,y=4;break}let L=1;for(let t=0;t<s;t++)p.value[L].role=z.Defender,L++;for(let t=0;t<_;t++)p.value[L].role=z.Midfielder,L++;for(let t=0;t<y;t++)p.value[L].role=z.Forward,L++;l.value=Array.from({length:7},(t,A)=>({number:12+A,player:null}))};Ee(v,()=>{i()}),Ee(()=>e.lineup,d=>{var s;d&&(v.value=d.formation,i(),((s=r.playersByTeam[e.team.id])==null?void 0:s.length)>0&&M())},{immediate:!0}),Ee(()=>r.playersByTeam[e.team.id],d=>{d&&d.length>0&&e.lineup&&M()},{immediate:!0}),aa(async()=>{if(i(),e.team&&(!r.playersByTeam[e.team.id]||r.playersByTeam[e.team.id].length===0))try{await r.fetchPlayersByTeam(e.team.id),e.lineup&&M()}catch(d){console.error("Failed to fetch team players:",d)}});const R=()=>{var d,s,_,y,L;return{id:((d=e.lineup)==null?void 0:d.id)||"",teamId:e.team.id,matchId:((s=e.lineup)==null?void 0:s.matchId)||"",formation:v.value,players:[...p.value.filter(t=>t.player!==null).map(t=>{var A;return{id:t.player.id,playerId:t.player.playerId,lineupId:((A=e.lineup)==null?void 0:A.id)||"",isStarter:!0,position:t.number.toString(),teamId:e.team.id,ratings:t.player.ratings,averageRating:t.player.averageRating}}),...l.value.filter(t=>t.player!==null).map(t=>{var A;return{id:t.player.id,playerId:t.player.playerId,lineupId:((A=e.lineup)==null?void 0:A.id)||"",isStarter:!1,position:t.number.toString(),teamId:e.team.id,ratings:t.player.ratings,averageRating:t.player.averageRating}})],createdAt:((_=e.lineup)==null?void 0:_.createdAt)||new Date().toISOString(),updatedAt:((y=e.lineup)==null?void 0:y.updatedAt)||new Date().toISOString(),isStarting:((L=e.lineup)==null?void 0:L.isStarting)||!0}},X=j(()=>{const d=r.playersByTeam[e.team.id]||[],s=new Set([...p.value.map(_=>{var y;return(y=_.player)==null?void 0:y.playerId}),...l.value.map(_=>{var y;return(y=_.player)==null?void 0:y.playerId})]);return d.filter(_=>!s.has(_.id))}),I=d=>{var L;const s=r.playersByTeam[e.team.id]||[],_=new Set([...p.value.map(t=>{var A;return(A=t.player)==null?void 0:A.playerId}),...l.value.map(t=>{var A;return(A=t.player)==null?void 0:A.playerId})]),y=(L=p.value.find(t=>t.role===d))==null?void 0:L.player;return s.filter(t=>d===t.position).filter(t=>!_.has(t.id)||t.id===(y==null?void 0:y.playerId)).map(t=>{var A;return{id:"",playerId:t.id,lineupId:((A=e.lineup)==null?void 0:A.id)||"",isStarter:!0,position:d.toString(),teamId:e.team.id,player:t}})},q=j(()=>{const d=p.value.filter(_=>_.player).length,s=l.value.filter(_=>_.player).length;return{is_valid:d===11&&s<=8,starting_count:d,substitute_count:s,message:d<11?`Need ${11-d} more starting players`:d>11?"Too many starting players":s>8?"Too many substitutes":"Valid lineup"}}),be=(d,s)=>{s&&!Qe(s.playerId,d+1)||(p.value[d].player=s)},he=(d,s)=>{q.value.substitute_count>=8&&!l.value[d].player||s&&!Qe(s.playerId,12+d)||(l.value[d].player=s)},ve=async()=>{var H;if(console.log("Starting auto-fill with team players:",m),!m.length){console.log("No players loaded, fetching team players...");try{await r.fetchPlayersByTeam(e.team.id)}catch(x){console.error("Failed to fetch team players:",x);return}}const d=[...r.playersByTeam[e.team.id]||[]];if(console.log("Available players:",d),!d.length){console.log("No players available for auto-fill");return}p.value.forEach(x=>x.player=null),l.value.forEach(x=>x.player=null);const s=d.find(x=>x.position===z.Goalkeeper);s&&(console.log("Found goalkeeper:",s),p.value[0].player={id:"",playerId:s.id,lineupId:((H=e.lineup)==null?void 0:H.id)||"",isStarter:!0,position:"1",teamId:e.team.id,player:s},d.splice(d.indexOf(s),1));const _=v.value;let y=4,L=4,t=2;switch(_){case k.Formation442:y=4,L=4,t=2;break;case k.Formation433:y=4,L=3,t=3;break;case k.Formation352:y=3,L=5,t=2;break;case k.Formation343:y=3,L=4,t=3;break;case k.Formation4231:y=4,L=2,t=3;break;case k.Formation4321:y=4,L=3,t=2;break;case k.Formation532:y=5,L=3,t=2;break;case k.Formation541:y=5,L=4,t=1;break;case k.Formation451:y=4,L=5,t=1;break;case k.Formation523:y=5,L=2,t=3;break;case k.Formation4141:y=4,L=1,t=4;break;case k.Formation3142:y=3,L=1,t=4;break}let A=1;const U=(x,ue)=>{var se;for(let de=0;de<ue&&A<p.value.length;de++){let ge=d.findIndex(Se=>Se.position===x);if(ge===-1&&d.length>0&&(ge=0),ge!==-1){const Se=d[ge];p.value[A].player={id:"",playerId:Se.id,lineupId:((se=e.lineup)==null?void 0:se.id)||"",isStarter:!0,position:A.toString(),teamId:e.team.id,player:Se},d.splice(ge,1),A++}}};U(z.Defender,y),U(z.Midfielder,L),U(z.Forward,t),l.value.forEach((x,ue)=>{var se;if(d.length>0){const de=d.shift();de&&(x.player={id:"",playerId:de.id,lineupId:((se=e.lineup)==null?void 0:se.id)||"",isStarter:!1,position:(12+ue).toString(),teamId:e.team.id,player:de})}})},_e=()=>{if(!Te.value.isValid){u.notify({color:"negative",message:`Invalid formation. Expected: ${Te.value.expected.defenders}-${Te.value.expected.midfielders}-${Te.value.expected.forwards}`});return}try{F.value=!0;const d=R();S("update:lineup",d),S("save"),w.value=!1,e.lineup&&(p.value.forEach(s=>{var _;if(s.player){const y=(_=e.lineup)==null?void 0:_.players.find(L=>{var t;return L.playerId===((t=s.player)==null?void 0:t.playerId)&&parseInt(L.position)===s.number});y&&(s.player=y)}}),l.value.forEach(s=>{var _;if(s.player){const y=(_=e.lineup)==null?void 0:_.players.find(L=>{var t;return L.playerId===((t=s.player)==null?void 0:t.playerId)&&parseInt(L.position)===s.number});y&&(s.player=y)}}))}finally{F.value=!1}},ne=d=>d!=null&&d.player?`${d.player.firstName} ${d.player.lastName}`:"",da=()=>{var d;te.startRatingMode(((d=e.lineup)==null?void 0:d.players)||[])},ma=()=>{te.stopRatingMode()},Ne=async(d,s)=>{try{if(s<1||s>10){u.notify({color:"negative",message:"Rating must be between 1 and 10"});return}Y.value=!0,await te.updatePlayerRating(d,s),u.notify({color:"positive",message:"Rating updated successfully"})}catch(_){console.error("Error updating player rating:",_),u.notify({color:"negative",message:"Failed to update rating"})}finally{Y.value=!1}},we=d=>{var s;return(s=d==null?void 0:d.ratings)!=null&&s.length?d.ratings[d.ratings.length-1].score:0},Be=async d=>{try{Y.value=!0,await te.removePlayerRating(d),u.notify({color:"positive",message:"Rating removed successfully"})}catch(s){console.error("Error removing player rating:",s),u.notify({color:"negative",message:"Failed to remove rating"})}finally{Y.value=!1}},Qe=(d,s)=>{const _=p.value.some(L=>{var t;return((t=L.player)==null?void 0:t.playerId)===d&&L.number!==s}),y=l.value.some(L=>{var t;return((t=L.player)==null?void 0:t.playerId)===d});return _||y?(u.notify({color:"negative",message:"Player is already selected in another position"}),!1):!0},Te=j(()=>{const d=v.value;let s=4,_=4,y=2;switch(d){case k.Formation442:s=4,_=4,y=2;break;case k.Formation433:s=4,_=3,y=3;break;case k.Formation352:s=3,_=5,y=2;break;case k.Formation343:s=3,_=4,y=3;break;case k.Formation4231:s=4,_=2,y=3;break;case k.Formation4321:s=4,_=3,y=2;break;case k.Formation532:s=5,_=3,y=2;break;case k.Formation541:s=5,_=4,y=1;break;case k.Formation451:s=4,_=5,y=1;break;case k.Formation523:s=5,_=2,y=3;break;case k.Formation4141:s=4,_=1,y=4;break;case k.Formation3142:s=3,_=1,y=4;break}const L=p.value.filter(U=>U.role===z.Defender).length,t=p.value.filter(U=>U.role===z.Midfielder).length,A=p.value.filter(U=>U.role===z.Forward).length;return{isValid:L===s&&t===_&&A===y,expected:{defenders:s,midfielders:_,forwards:y},current:{defenders:L,midfielders:t,forwards:A}}});return(d,s)=>{var _,y,L;return b(),C("div",yt,[w.value?(b(),C("div",vt," Lineup ID: "+E(((_=d.lineup)==null?void 0:_.id)||"None")+" Players: "+E(((L=(y=d.lineup)==null?void 0:y.players)==null?void 0:L.length)||0),1)):D("",!0),w.value?(b(),C("div",ft,[P("div",ht,[a(re,{modelValue:v.value,"onUpdate:modelValue":s[0]||(s[0]=t=>v.value=t),options:c,label:"Formation",outlined:"",dense:"","emit-value":"","map-options":"",class:"q-mb-md"},null,8,["modelValue"])])])):D("",!0),d.team?(b(),G(ie,{key:2},{default:n(()=>[a(ae,{class:Ve([[w.value?"bg-primary":"bg-negative"],"text-white"])},{default:n(()=>[P("div",gt,[P("div",null,[P("div",bt,E(d.team.name),1),P("div",_t,"Formation: "+E(v.value),1)]),P("div",wt,[w.value?D("",!0):(b(),G(B,{key:0,color:"white","text-color":"primary",icon:"edit",label:"Edit Lineup",onClick:le})),!w.value&&!$(te).isRating.value?(b(),G(B,{key:1,color:"white","text-color":"primary",icon:"star",label:"Rate Players",onClick:da})):D("",!0),$(te).isRating.value?(b(),G(B,{key:2,color:"white","text-color":"primary",icon:"close",label:"Close Rating",onClick:ma})):D("",!0)])])]),_:1},8,["class"]),a(ae,null,{default:n(()=>[P("div",Tt,"Starting XI ("+E(q.value.starting_count)+"/11)",1),a(Me,{bordered:"",separator:""},{default:n(()=>[(b(!0),C(ce,null,Le(p.value,(t,A)=>(b(),G(oe,{key:A},{default:n(()=>[a(K,{avatar:""},{default:n(()=>[a(Ce,{color:t.player?"primary":"grey","text-color":"white"},{default:n(()=>[V(E(t.number),1)]),_:2},1032,["color"])]),_:2},1024),a(K,null,{default:n(()=>[w.value?(b(),G(re,{key:0,modelValue:t.player,"onUpdate:modelValue":[U=>t.player=U,U=>be(A,U)],options:I(t.role),"option-label":U=>ne(U),label:t.role+" - Select Player",outlined:"",dense:"",clearable:"","emit-value":"","map-options":"",rules:[U=>!!U||"Player is required"]},{option:n(({itemProps:U,opt:H,selected:x,toggleOption:ue})=>[a(oe,xe({ref_for:!0},U,{onClick:se=>ue(H)}),{default:n(()=>[a(K,null,{default:n(()=>[a(J,null,{default:n(()=>[V(E(ne(H)),1)]),_:2},1024),a(J,{caption:""},{default:n(()=>[V(E(H.position),1)]),_:2},1024)]),_:2},1024),a(K,{side:""},{default:n(()=>[a(je,{dense:"","model-value":x},null,8,["model-value"])]),_:2},1024)]),_:2},1040,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","options","option-label","label","rules"])):(b(),C("div",St,[P("div",It,[a(J,null,{default:n(()=>[V(E(ne(t.player)),1)]),_:2},1024),a(J,{caption:""},{default:n(()=>[V(E(t.role),1)]),_:2},1024)]),P("div",kt,[t.player?(b(),G(ze,{key:0,"model-value":we(t.player),size:"1.5em",max:10,icon:"star_border","icon-selected":"star",disable:!$(te).isRating.value||Y.value,"onUpdate:modelValue":U=>{t.player&&(console.log("Rating updated for player:",t.player.id,"value:",U),Ne(t.player.id,U))}},null,8,["model-value","disable","onUpdate:modelValue"])):D("",!0),$(te).isRating.value&&t.player&&we(t.player)>0?(b(),G(B,{key:1,flat:"",round:"",dense:"",color:"negative",icon:"close",size:"sm",class:"q-ml-sm",onClick:U=>Be(t.player.id)},null,8,["onClick"])):D("",!0)])]))]),_:2},1024)]),_:2},1024))),128))]),_:1}),P("div",Lt,"Substitutes ("+E(q.value.substitute_count)+"/8)",1),a(Me,{bordered:"",separator:""},{default:n(()=>[w.value?(b(!0),C(ce,{key:0},Le(l.value,(t,A)=>{var U;return b(),G(oe,{key:((U=t.player)==null?void 0:U.id)||A},{default:n(()=>[a(K,{avatar:""},{default:n(()=>[a(Ce,{color:t.player?"grey-6":"grey","text-color":"white"},{default:n(()=>[V(E(t.number),1)]),_:2},1032,["color"])]),_:2},1024),a(K,null,{default:n(()=>[a(re,{modelValue:t.player,"onUpdate:modelValue":[H=>t.player=H,H=>he(A,H)],options:X.value,"option-label":H=>ne(H),label:"Select Substitute",outlined:"",dense:"",clearable:"","emit-value":"","map-options":"",disable:q.value.substitute_count>=8&&!t.player},{option:n(({itemProps:H,opt:x,selected:ue,toggleOption:se})=>[a(oe,xe({ref_for:!0},H,{onClick:de=>se(x)}),{default:n(()=>[a(K,null,{default:n(()=>[a(J,null,{default:n(()=>[V(E(ne(x)),1)]),_:2},1024),a(J,{caption:""},{default:n(()=>[V(E(x.position),1)]),_:2},1024)]),_:2},1024),a(K,{side:""},{default:n(()=>[a(je,{dense:"","model-value":ue},null,8,["model-value"])]),_:2},1024)]),_:2},1040,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","options","option-label","disable"])]),_:2},1024)]),_:2},1024)}),128)):(b(!0),C(ce,{key:1},Le(l.value,(t,A)=>{var U;return b(),G(oe,{key:((U=t.player)==null?void 0:U.id)||A},{default:n(()=>[a(K,{avatar:""},{default:n(()=>[a(Ce,{color:"grey-4","text-color":"grey-8"},{default:n(()=>[V(E(t.number),1)]),_:2},1024)]),_:2},1024),a(K,null,{default:n(()=>[P("div",$t,[P("div",Pt,[a(J,null,{default:n(()=>[V(E(ne(t.player)),1)]),_:2},1024),a(J,{caption:""},{default:n(()=>{var H,x;return[V(E((x=(H=t.player)==null?void 0:H.player)==null?void 0:x.position),1)]}),_:2},1024)]),P("div",Ft,[t.player?(b(),G(ze,{key:0,"model-value":we(t.player),size:"1.5em",max:10,icon:"star_border","icon-selected":"star",disable:!$(te).isRating.value||Y.value,"onUpdate:modelValue":H=>{t.player&&(console.log("Rating updated for substitute:",t.player.id,"value:",H),Ne(t.player.id,H))}},null,8,["model-value","disable","onUpdate:modelValue"])):D("",!0),$(te).isRating.value&&t.player&&we(t.player)>0?(b(),G(B,{key:1,flat:"",round:"",dense:"",color:"negative",icon:"close",size:"sm",class:"q-ml-sm",onClick:H=>Be(t.player.id)},null,8,["onClick"])):D("",!0)])])]),_:2},1024)]),_:2},1024)}),128)),l.value.length===0?(b(),G(oe,{key:2},{default:n(()=>[a(K,null,{default:n(()=>[a(J,{class:"text-grey-7"},{default:n(()=>s[2]||(s[2]=[V("No substitutes")])),_:1})]),_:1})]),_:1})):D("",!0)]),_:1}),w.value?(b(),G(pt,{key:0,class:Ve([q.value.is_valid?"bg-positive":"bg-warning","text-white q-mt-md"])},{default:n(()=>[V(E(q.value.message),1)]),_:1},8,["class"])):D("",!0),w.value?(b(),C("div",Et,[P("div",Ct,[a(B,{color:"primary",icon:"add",label:"Add New Player",class:"full-width",onClick:s[1]||(s[1]=t=>d.$emit("add-player-click"))})]),P("div",qt,[a(B,{color:"secondary",icon:"auto_fix_high",label:"Auto-fill Lineup",class:"full-width",onClick:ve})]),P("div",At,[a(B,{color:"positive",icon:"save",label:"Save Lineup",disable:!q.value.is_valid,loading:F.value,onClick:_e,class:"full-width"},null,8,["disable","loading"])]),P("div",Vt,[a(B,{color:"negative",icon:"cancel",label:"Cancel",onClick:fe,class:"full-width"})])])):D("",!0)]),_:1})]),_:1})):D("",!0)])}}}),Xe=ee(Mt,[["__scopeId","data-v-550329d6"]]),Ie=va("lineup",{state:()=>({lineups:{},loading:!1,error:null}),getters:{getLineupByteam_id:o=>h=>Object.values(o.lineups).find(e=>e.teamId===h),getLineupById:o=>h=>o.lineups[h]},actions:{setLineup(o){o.id&&(this.lineups[String(o.id)]=o)},setLoading(o){this.loading=o},setError(o){this.error=o},clearError(){this.error=null},removeLineup(o){delete this.lineups[o]}}});Ue`
  query GetMatchLineups($filter: MatchFilterInput) {
    matches(first: 1, where: $filter) {
      nodes {
        ...LineupFields
      }
    }
  }
  ${Ge}
`;const Rt=Ue`
  query GetLineup($id: String!) {
    lineup(id: $id) {
      ...LineupFields
    }
  }
  ${Ge}
`,Gt=Ue`
  query GetTeamLineups($teamId: String!, $matchId: String) {
    teamLineups(teamId: $teamId, matchId: $matchId) {
      nodes {
        ...LineupFields
      }
    }
  }
  ${Ge}
`,ke={useLineup(o){var c;const{result:h,loading:e,error:S,refetch:r}=Oe(Rt,{id:o}),m=Ie();return(c=h.value)!=null&&c.lineup&&m.setLineup(h.value.lineup),{lineup:h,loading:e,error:S,refetch:r}},useTeamLineups(o,h){var v;const{result:e,loading:S,error:r,refetch:m}=Oe(Gt,{teamId:o,matchId:h}),c=Ie();return(v=e.value)!=null&&v.teamLineups&&e.value.teamLineups.forEach(p=>{c.setLineup(p)}),{lineups:e,loading:S,error:r,refetch:m}},useSaveLineup(){const{mutate:o,loading:h,error:e}=$e(Ia),S=Ie(),r=Pe();return{saveLineup:async c=>{var v,p;try{const l=await o({lineup:c});if((v=l==null?void 0:l.data)!=null&&v.saveLineup){const w=l.data.saveLineup;S.setLineup(w);const g=r.matches.findIndex(f=>f.id===c.matchId);if(g!==-1){const f=r.matches[g],u={...f,homeTeamLineupId:f.homeTeamId===c.teamId?w.id:f.homeTeamLineupId,awayTeamLineupId:f.awayTeamId===c.teamId?w.id:f.awayTeamLineupId,homeTeamLineup:f.homeTeamId===c.teamId?w:f.homeTeamLineup,awayTeamLineup:f.awayTeamId===c.teamId?w:f.awayTeamLineup};r.updateMatch(u)}}return(p=l==null?void 0:l.data)==null?void 0:p.saveLineup}catch(l){throw console.error("Error saving lineup:",l),l}},loading:h,error:e}},useDeleteLineup(){const{mutate:o,loading:h,error:e}=$e(Sa),S=Ie(),r=Pe();return{deleteLineup:async c=>{var v,p;try{const l=await o({id:c});if((v=l==null?void 0:l.data)!=null&&v.deleteLineup){S.removeLineup(c);const w=r.matches.findIndex(g=>g.homeTeamLineupId===c||g.awayTeamLineupId===c);if(w!==-1){const g=r.matches[w],f={...g,homeTeamLineupId:g.homeTeamLineupId===c?null:g.homeTeamLineupId,awayTeamLineupId:g.awayTeamLineupId===c?null:g.awayTeamLineupId,homeTeamLineup:g.homeTeamLineupId===c?null:g.homeTeamLineup,awayTeamLineup:g.awayTeamLineupId===c?null:g.awayTeamLineup};r.updateMatch(f)}}return(p=l==null?void 0:l.data)==null?void 0:p.deleteLineup}catch(l){throw console.error("Error deleting lineup:",l),l}},loading:h,error:e}}},Dt={class:"match-lineups"},Ut={key:0,class:"flex justify-center q-pa-xl"},Nt={key:1,class:"text-negative q-pa-md"},Bt={key:2,class:"row q-col-gutter-md"},Qt={class:"col-12 col-md-6"},Ht={class:"col-12 col-md-6"},xt=Z({__name:"MatchLineups",props:{match:{},loading:{type:Boolean},error:{}},emits:["update:match"],setup(o,{emit:h}){const e=o,S=h,r=oa(),m=ia(),c=N(!1),v=N("home"),p=[{label:"Goalkeeper",value:z.Goalkeeper},{label:"Defender",value:z.Defender},{label:"Midfielder",value:z.Midfielder},{label:"Forward",value:z.Forward}],l=N({first_name:"",last_name:"",position:z.Midfielder,number:null,nationality:"",date_of_birth:""}),w=i=>{v.value=i,c.value=!0},g=async i=>{await ke.useSaveLineup().saveLineup({...i,matchId:e.match.id,teamId:e.match.homeTeam.id})},f=async i=>{await ke.useSaveLineup().saveLineup({...i,matchId:e.match.id,teamId:e.match.awayTeam.id})},u=i=>{S("update:match",{...e.match,homeTeam:i})},F=i=>{S("update:match",{...e.match,awayTeam:i})},Y=i=>i.teamId?i.formation?Array.isArray(i.players)?i.players.length===0?(console.error("Invalid lineup: no players in the lineup"),!1):!0:(console.error("Invalid lineup: players must be an array"),!1):(console.error("Invalid lineup: missing formation"),!1):(console.error("Invalid lineup: missing teamId"),!1),le=async()=>{if(e.match.homeTeamLineup)try{if(!Y(e.match.homeTeamLineup))throw new Error("Invalid lineup data");const i={...e.match.homeTeamLineup,matchId:e.match.id,teamId:e.match.homeTeam.id};await ke.useSaveLineup().saveLineup(i),m.notify({type:"positive",message:"Home team lineup saved successfully"})}catch(i){console.error("Failed to save home team lineup:",i),m.notify({type:"negative",message:i instanceof Error?i.message:"Failed to save home team lineup"})}},fe=async()=>{if(e.match.awayTeamLineup)try{if(!Y(e.match.awayTeamLineup))throw new Error("Invalid lineup data");const i={...e.match.awayTeamLineup,matchId:e.match.id,teamId:e.match.awayTeam.id};await ke.useSaveLineup().saveLineup(i),m.notify({type:"positive",message:"Away team lineup saved successfully"})}catch(i){console.error("Failed to save away team lineup:",i),m.notify({type:"negative",message:i instanceof Error?i.message:"Failed to save away team lineup"})}},M=async()=>{if(!l.value.first_name||!l.value.last_name||!l.value.position||!l.value.number){m.notify({type:"warning",message:"Please fill in all fields"});return}try{const i=v.value==="home"?e.match.homeTeamId:e.match.awayTeamId;await r.createPlayer({firstName:l.value.first_name,lastName:l.value.last_name,position:l.value.position,teamId:i}),await r.fetchPlayersByTeam(i),m.notify({type:"positive",message:"Player added successfully"}),l.value={first_name:"",last_name:"",position:z.Midfielder,number:null,nationality:"",date_of_birth:""},c.value=!1}catch(i){console.error("Error adding player:",i),m.notify({type:"negative",message:"Failed to add player"})}};return aa(async()=>{try{if(e.match.homeTeam&&(!e.match.homeTeam.players||e.match.homeTeam.players.length===0))try{const i=await r.fetchPlayersByTeam(e.match.homeTeam.id);i&&(r.playersByTeam[e.match.homeTeam.id]=i)}catch(i){console.error("Failed to fetch home team players:",i)}if(e.match.awayTeam&&(!e.match.awayTeam.players||e.match.awayTeam.players.length===0))try{const i=await r.fetchPlayersByTeam(e.match.awayTeam.id);i&&(r.playersByTeam[e.match.awayTeam.id]=i)}catch(i){console.error("Failed to fetch away team players:",i)}}catch(i){console.error("Failed to initialize lineups:",i)}}),(i,R)=>{var X,I;return b(),C("div",Dt,[R[8]||(R[8]=P("div",{class:"text-h6 q-mb-md"},"Lineups",-1)),i.loading?(b(),C("div",Ut,[a(ta,{color:"primary",size:"3em"})])):i.error?(b(),C("div",Nt,E(i.error),1)):(b(),C("div",Bt,[P("div",Qt,[(X=i.match)!=null&&X.homeTeam?(b(),G(Xe,{key:0,team:i.match.homeTeam,lineup:i.match.homeTeamLineup,loading:i.loading,"onUpdate:lineup":g,onSave:le,onAddPlayerClick:R[0]||(R[0]=q=>w("home")),"onUpdate:team":u},null,8,["team","lineup","loading"])):D("",!0)]),P("div",Ht,[(I=i.match)!=null&&I.awayTeam?(b(),G(Xe,{key:0,team:i.match.awayTeam,lineup:i.match.awayTeamLineup,loading:i.loading,"onUpdate:lineup":f,onSave:fe,onAddPlayerClick:R[1]||(R[1]=q=>w("away")),"onUpdate:team":F},null,8,["team","lineup","loading"])):D("",!0)])])),a(Re,{modelValue:c.value,"onUpdate:modelValue":R[6]||(R[6]=q=>c.value=q),persistent:""},{default:n(()=>[a(ie,{style:{"min-width":"350px"}},{default:n(()=>[a(ae,null,{default:n(()=>R[7]||(R[7]=[P("div",{class:"text-h6"},"Add New Player",-1)])),_:1}),a(ae,{class:"q-pt-none"},{default:n(()=>[a(na,{onSubmit:M,class:"q-gutter-md"},{default:n(()=>[a(me,{modelValue:l.value.first_name,"onUpdate:modelValue":R[2]||(R[2]=q=>l.value.first_name=q),label:"First Name",rules:[q=>!!q||"First name is required"]},null,8,["modelValue","rules"]),a(me,{modelValue:l.value.last_name,"onUpdate:modelValue":R[3]||(R[3]=q=>l.value.last_name=q),label:"Last Name",rules:[q=>!!q||"Last name is required"]},null,8,["modelValue","rules"]),a(re,{modelValue:l.value.position,"onUpdate:modelValue":R[4]||(R[4]=q=>l.value.position=q),options:p,label:"Position",rules:[q=>!!q||"Position is required"]},null,8,["modelValue","rules"]),a(me,{modelValue:l.value.number,"onUpdate:modelValue":R[5]||(R[5]=q=>l.value.number=q),modelModifiers:{number:!0},type:"number",label:"Jersey Number",rules:[q=>!!q||"Jersey number is required",q=>q>0||"Jersey number must be positive",q=>q<=99||"Jersey number must be less than 100"]},null,8,["modelValue","rules"])]),_:1})]),_:1}),a(ct,{align:"right",class:"text-primary"},{default:n(()=>[fa(a(B,{flat:"",label:"Cancel"},null,512),[[$a]]),a(B,{flat:"",label:"Add Player",type:"submit",onClick:M})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Ot=ee(xt,[["__scopeId","data-v-3cb0ccbd"]]),Ke=Fe({name:"QTimelineEntry",props:{heading:Boolean,tag:{type:String,default:"h3"},side:{type:String,default:"right",validator:o=>["left","right"].includes(o)},icon:String,avatar:String,color:String,title:String,subtitle:String,body:String},setup(o,{slots:h}){const e=ha(la,qe);if(e===qe)return console.error("QTimelineEntry needs to be child of QTimeline"),qe;const S=j(()=>`q-timeline__entry q-timeline__entry--${o.side}`+(o.icon!==void 0||o.avatar!==void 0?" q-timeline__entry--icon":"")),r=j(()=>`q-timeline__dot text-${o.color||e.color}`),m=j(()=>e.layout==="comfortable"&&e.side==="left");return()=>{const c=ga(h.default,[]);if(o.body!==void 0&&c.unshift(o.body),o.heading===!0){const l=[O("div"),O("div"),O(o.tag,{class:"q-timeline__heading-title"},c)];return O("div",{class:"q-timeline__heading"},m.value===!0?l.reverse():l)}let v;o.icon!==void 0?v=[O(We,{class:"row items-center justify-center",name:o.icon})]:o.avatar!==void 0&&(v=[O("img",{class:"q-timeline__dot-img",src:o.avatar})]);const p=[O("div",{class:"q-timeline__subtitle"},[O("span",{},pe(h.subtitle,[o.subtitle]))]),O("div",{class:r.value},v),O("div",{class:"q-timeline__content"},[O("h6",{class:"q-timeline__title"},pe(h.title,[o.title]))].concat(c))];return O("li",{class:S.value},m.value===!0?p.reverse():p)}}}),jt=Fe({name:"QTimeline",props:{...ra,color:{type:String,default:"primary"},side:{type:String,default:"right",validator:o=>["left","right"].includes(o)},layout:{type:String,default:"dense",validator:o=>["dense","comfortable","loose"].includes(o)}},setup(o,{slots:h}){const e=ea(),S=sa(o,e.proxy.$q);ba(la,o);const r=j(()=>`q-timeline q-timeline--${o.layout} q-timeline--${o.layout}--${o.side}`+(S.value===!0?" q-timeline--dark":""));return()=>O("ul",{class:r.value},pe(h.default))}}),zt={class:"match-info"},Yt={class:"row q-col-gutter-md"},Jt={class:"col-12 col-md-6"},Xt={class:"col-12 col-md-6"},Kt={key:0},Wt=Z({__name:"MatchInfo",props:{match:{}},setup(o){const h=r=>{if(!r)return"N/A";try{const m=new Date(r);return m.setHours(m.getHours()+1),m.toLocaleString("nb-NO",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}).replace("kl.","").replace(", ",`
`).trim()}catch{return r}},e=r=>{switch(r){case T.Goal:return"âš½ Goal";case T.YellowCard:return"ðŸŸ¨ Yellow Card";case T.RedCard:return"ðŸŸ¥ Red Card";case T.Substitution:return"ï¿½ï¿½ Substitution";case T.HalfTimeStart:return"â±ï¸ Half Time";case T.GameEnd:return"ðŸ Full Time";default:return r}},S=r=>{var p;const m=r.player?`${r.player.firstName} ${r.player.lastName}`:"Unknown Player",c=r.secondaryPlayer?`${r.secondaryPlayer.firstName} ${r.secondaryPlayer.lastName}`:"",v=((p=r.team)==null?void 0:p.name)||"";switch(r.type){case T.Goal:return`Goal by ${m} (${v})${c?` - Assist by ${c}`:""}`;case T.YellowCard:case T.RedCard:return`${r.type===T.YellowCard?"Yellow":"Red"} card shown to ${m} (${v})`;case T.Substitution:return`${m} replaced by ${c} (${v})`;case T.HalfTimeStart:return"Half Time";case T.GameEnd:return"Full Time";default:return r.description||"Event"}};return(r,m)=>(b(),C("div",zt,[a(ie,{flat:"",bordered:""},{default:n(()=>[a(ae,null,{default:n(()=>m[0]||(m[0]=[P("div",{class:"text-h6"},"Match Information",-1)])),_:1}),a(De),a(ae,null,{default:n(()=>[P("div",Yt,[P("div",Jt,[a(Me,null,{default:n(()=>[a(oe,null,{default:n(()=>[a(K,null,{default:n(()=>[a(J,{caption:""},{default:n(()=>m[1]||(m[1]=[V("Date & Time")])),_:1}),a(J,null,{default:n(()=>[V(E(h(r.match.scheduledDate)),1)]),_:1})]),_:1})]),_:1}),a(oe,null,{default:n(()=>[a(K,null,{default:n(()=>[a(J,{caption:""},{default:n(()=>m[2]||(m[2]=[V("Status")])),_:1}),a(J,null,{default:n(()=>[V(E(r.match.status),1)]),_:1})]),_:1})]),_:1}),a(oe,null,{default:n(()=>[a(K,null,{default:n(()=>[a(J,{caption:""},{default:n(()=>m[3]||(m[3]=[V("Score")])),_:1}),a(J,null,{default:n(()=>{var c,v,p,l;return[V(E((c=r.match.homeTeam)==null?void 0:c.name)+" "+E((v=r.match.score)==null?void 0:v.homeTeamScore)+" - "+E((p=r.match.score)==null?void 0:p.awayTeamScore)+" "+E((l=r.match.awayTeam)==null?void 0:l.name),1)]}),_:1})]),_:1})]),_:1})]),_:1})]),P("div",Xt,[m[5]||(m[5]=P("div",{class:"text-subtitle2 q-mb-sm"},"Match Events",-1)),a(jt,{color:"primary"},{default:n(()=>[(b(!0),C(ce,null,Le(r.match.events||[],c=>(b(),G(Ke,{key:c.id,title:S(c),subtitle:`${c.minuteOfMatch}' - ${e(c.type)}`,icon:"sports_soccer"},{default:n(()=>[c.description?(b(),C("div",Kt,E(c.description),1)):D("",!0)]),_:2},1032,["title","subtitle"]))),128)),!r.match.events||r.match.events.length===0?(b(),G(Ke,{key:0,title:"No Events",icon:"sports_soccer"},{default:n(()=>m[4]||(m[4]=[P("div",null,"No events recorded for this match yet.",-1)])),_:1})):D("",!0)]),_:1})])])]),_:1})]),_:1})]))}}),Zt=ee(Wt,[["__scopeId","data-v-27b1ef49"]]),el={class:"match-detail"},al={key:0,class:"flex justify-center q-pa-xl"},tl={key:1,class:"text-negative q-pa-md"},ll={key:2,class:"match-content"},nl={key:0,class:"row justify-end q-mb-md"},ol=Z({__name:"MatchDetailPage",setup(o){const h=_a(),e=Ze(),S=j(()=>e.isAuthenticated),r=N(!1),m=N(T.Goal),{match:c,loading:v,error:p,refetch:l}=ye.useMatch(h.params.id),w=async f=>{try{const{updateMatch:u}=ye.useUpdateMatch();await u(f)}catch(u){console.error("Error updating match:",u)}},g=async()=>{r.value=!1,await l()};return(f,u)=>{var F,Y;return b(),C("div",el,[$(v)?(b(),C("div",al,[a(ta,{color:"primary",size:"3em"})])):$(p)?(b(),C("div",tl,E($(p).message),1)):(b(),C("div",ll,[a(at,{match:$(c),loading:$(v),error:(F=$(p))==null?void 0:F.message,"onUpdate:match":w},null,8,["match","loading","error"]),a(mt,{match:$(c),"onUpdate:match":w},null,8,["match"]),a(Ot,{match:$(c),loading:$(v),error:(Y=$(p))==null?void 0:Y.message,"onUpdate:match":w},null,8,["match","loading","error"]),a(Zt,{match:$(c)},null,8,["match"]),S.value?(b(),C("div",nl,[a(B,{color:"primary",icon:"add",label:"Add Event",onClick:u[0]||(u[0]=le=>r.value=!0)})])):D("",!0),a(Re,{modelValue:r.value,"onUpdate:modelValue":u[2]||(u[2]=le=>r.value=le),persistent:""},{default:n(()=>[a(ie,{style:{"min-width":"500px"}},{default:n(()=>[a(ua,{match:$(c),"event-type":m.value,onEventAdded:g,onCancel:u[1]||(u[1]=le=>r.value=!1)},null,8,["match","event-type"])]),_:1})]),_:1},8,["modelValue"])]))])}}}),$l=ee(ol,[["__scopeId","data-v-f763cfa6"]]);export{$l as default};
